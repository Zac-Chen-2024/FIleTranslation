<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§»æ°‘ææ–™ç¿»è¯‘</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”„</text></svg>" type="image/svg+xml">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%233b82f6'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' font-size='60' fill='white'>è¯‘</text></svg>" type="image/svg+xml">
    <style>
        :root {
            --screen-width: 100vw;
            --screen-height: 100vh;
            --device-pixel-ratio: 1;
            --aspect-ratio: 1.33;
            --base-font-size: 16px;
            --container-padding: 20px;
            --panel-spacing: 15px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #f1f5f9;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* æ·»åŠ åŠ¨æ€èƒŒæ™¯æ•ˆæœ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(147, 51, 234, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(16, 185, 129, 0.06) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .container {
            display: flex;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
            border-radius: 0 0 20px 20px;
            overflow: hidden;
            box-shadow: 
                0 0 50px rgba(59, 130, 246, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .left-panel {
            flex: 0 0 450px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-right: 1px solid rgba(59, 130, 246, 0.2);
            overflow-y: auto;
            position: relative;
        }

        .left-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent,
                rgba(59, 130, 246, 0.6),
                rgba(147, 51, 234, 0.6),
                transparent
            );
        }

        .right-panel {
            flex: 1;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(15px);
            padding: 30px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #34d399);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.4em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.02em;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .header p {
            color: #cbd5e1;
            font-size: 1.1em;
            font-weight: 400;
            letter-spacing: 0.3px;
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #ffffff !important;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.6em;
            margin-left: 8px;
            font-weight: 600;
            box-shadow: 
                0 2px 8px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            -webkit-text-fill-color: #ffffff !important;
            background-clip: padding-box !important;
            -webkit-background-clip: padding-box !important;
        }

        .translation-options {
            margin-bottom: 30px;
        }

        .option-group {
            margin-bottom: 25px;
        }

        .option-label {
            font-weight: 600;
            margin-bottom: 15px;
            color: #f8fafc;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(90deg, #3b82f6, transparent);
            padding: 8px 0;
            border-left: 3px solid #3b82f6;
            padding-left: 12px;
        }

        .sub-label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #f8fafc;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.6), transparent);
            padding: 6px 0;
            border-left: 2px solid rgba(59, 130, 246, 0.8);
            padding-left: 10px;
            border-radius: 0 4px 4px 0;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 18px;
            border: 1px solid rgba(59, 130, 246, 0.25);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .radio-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(59, 130, 246, 0.08), 
                transparent
            );
            transition: left 0.3s ease;
        }

        .radio-item:hover::before {
            left: 100%;
        }

        .radio-item:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 
                0 10px 25px rgba(59, 130, 246, 0.15),
                0 0 0 1px rgba(59, 130, 246, 0.1);
            background: rgba(59, 130, 246, 0.03);
        }

        .radio-item.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.08), 
                rgba(147, 51, 234, 0.03)
            );
            box-shadow: 
                0 0 20px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .radio-item input[type="radio"] {
            display: none;
        }

        .radio-item label {
            cursor: pointer;
            font-weight: 500;
            flex: 1;
            color: #f8fafc;
            font-size: 1.05em;
        }

        .radio-item .description {
            font-size: 0.9em;
            color: #cbd5e1;
            margin-top: 4px;
            font-weight: 300;
        }

        .radio-item.active {
            border-color: #3b82f6;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.25), 
                rgba(147, 51, 234, 0.15)
            );
            box-shadow: 
                0 0 25px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .radio-item.active label {
            color: #ffffff;
        }

        .radio-item.active .description {
            color: #e2e8f0;
        }

        .input-section {
            margin-top: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #f8fafc;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        .input-group input, .input-group textarea, .input-group select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(59, 130, 246, 0.25);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.8);
            color: #f1f5f9;
            backdrop-filter: blur(10px);
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 
                0 0 0 3px rgba(59, 130, 246, 0.1),
                0 0 20px rgba(59, 130, 246, 0.15);
            background: rgba(15, 23, 42, 0.95);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: none;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .file-upload-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
        }

        /* å¢å¼ºç‰ˆæ–‡ä»¶ä¸Šä¼ æ ·å¼ */
        .file-upload-enhanced {
            width: 100%;
        }

        .file-upload-area {
            border: 2px dashed rgba(59, 130, 246, 0.5);
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .file-upload-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(
                from 0deg,
                transparent,
                rgba(59, 130, 246, 0.1),
                transparent
            );
            animation: rotate 3s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .file-upload-area:hover::before {
            opacity: 1;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .file-upload-area:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }

        .file-upload-icon {
            font-size: 24px;
            margin-bottom: 15px;
            opacity: 0.7;
            font-weight: 700;
            color: #3b82f6;
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .file-upload-text {
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .primary-text {
            font-size: 18px;
            font-weight: 500;
            color: #f1f5f9;
            margin-bottom: 8px;
        }

        .secondary-text {
            font-size: 14px;
            color: #cbd5e1;
            margin-bottom: 5px;
        }

        .file-size-hint {
            font-size: 12px;
            color: #94a3b8;
        }

        .file-upload-area .file-upload-btn {
            display: inline-block;
            width: auto;
            padding: 12px 24px;
            margin: 0;
            border-radius: 6px;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        /* æ–‡ä»¶é¢„è§ˆæ ·å¼ */
        .file-preview {
            margin-top: 15px;
            border: 2px dashed rgba(59, 130, 246, 0.5);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            height: 200px; /* åŒ¹é…ä¸Šä¼ åŒºåŸŸçš„é«˜åº¦ */
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: linear-gradient(90deg, 
                rgba(59, 130, 246, 0.1), 
                rgba(147, 51, 234, 0.05)
            );
            padding: 8px 12px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* é˜²æ­¢æ”¶ç¼© */
            height: 36px; /* å›ºå®šå¤´éƒ¨é«˜åº¦ï¼Œå‡å°ä»¥åŒ¹é…æ€»é«˜åº¦ */
        }

        .preview-title {
            font-weight: 500;
            color: #f1f5f9;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .remove-file-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
        }

        .remove-file-btn:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .preview-content {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 1.1em;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
            overflow-y: auto;
        }

        .preview-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(147, 51, 234, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .preview-content.has-content {
            align-items: flex-start;
            justify-content: flex-start;
            color: #f1f5f9;
        }

        /* å›¾ç‰‡é¢„è§ˆæ ·å¼ - å›ºå®šå¤§å°å’Œæ¯”ä¾‹ç¼©æ”¾ */
        .preview-image {
            width: 100px;
            height: 80px;
            object-fit: contain;
            object-position: center;
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            flex-shrink: 0; /* é˜²æ­¢å›¾ç‰‡è¢«å‹ç¼© */
        }

        /* è°ƒæ•´å›¾ç‰‡é¢„è§ˆæ—¶çš„preview-content */
        .preview-content.image-preview {
            padding: 30px 20px; /* ä¸file-upload-areaä¿æŒä¸€è‡´ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1; /* å ç”¨å‰©ä½™ç©ºé—´ */
            gap: 10px;
        }

        /* æ–‡ä»¶ä¿¡æ¯æ ·å¼è°ƒæ•´ */
        .file-info {
            flex: 1;
            margin-left: 12px;
            padding: 8px;
            background: rgba(59, 130, 246, 0.05);
            border-radius: 6px;
            border: 1px solid rgba(59, 130, 246, 0.1);
            min-width: 0; /* å…è®¸å†…å®¹æ”¶ç¼© */
        }

        .file-name {
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
            word-break: break-word;
            font-size: 0.8em;
            line-height: 1.2;
        }

        .file-size, .file-type {
            font-size: 0.7em;
            color: #cbd5e1;
            margin-bottom: 2px;
            line-height: 1.1;
        }

        /* å›¾ç‰‡å’Œæ–‡ä»¶ä¿¡æ¯çš„å®¹å™¨ */
        .image-info-container {
            display: flex;
            align-items: flex-start;
            width: 100%;
            gap: 0;
        }

        .result-content {
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 20px;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.05), 
                rgba(147, 51, 234, 0.02)
            );
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-item h4 {
            margin-bottom: 12px;
            color: #f1f5f9;
            font-size: 1.1em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-item p {
            margin: 8px 0;
            color: #cbd5e1;
            line-height: 1.5;
        }

        .result-item .success {
            color: #10b981;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .result-item .error {
            color: #ef4444;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            color: #3b82f6;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-message {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            font-weight: 500;
            backdrop-filter: blur(10px);
            border: 1px solid;
        }

        .status-message.success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border-color: rgba(16, 185, 129, 0.3);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.1);
        }

        .status-message.warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border-color: rgba(245, 158, 11, 0.3);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.1);
        }

        .log-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 15px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            font-size: 12px;
            display: none;
            backdrop-filter: blur(15px);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .log-container.show {
            display: block;
        }

        .log-entry {
            margin-bottom: 6px;
            padding: 4px 0;
            border-left: 2px solid transparent;
            padding-left: 8px;
            transition: all 0.2s ease;
        }

        .log-entry:hover {
            background: rgba(59, 130, 246, 0.05);
            border-left-color: #3b82f6;
        }

        .log-entry.info { 
            color: #3b82f6; 
            border-left-color: rgba(59, 130, 246, 0.3);
        }
        .log-entry.success { 
            color: #10b981; 
            border-left-color: rgba(16, 185, 129, 0.3);
        }
        .log-entry.warning { 
            color: #f59e0b; 
            border-left-color: rgba(245, 158, 11, 0.3);
        }
        .log-entry.error { 
            color: #ef4444; 
            border-left-color: rgba(239, 68, 68, 0.3);
        }
        .log-entry.debug { 
            color: #8b5cf6; 
            border-left-color: rgba(139, 92, 246, 0.3);
        }

        .hidden {
            display: none !important;
        }

        .backend-status {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .backend-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                #64748b, 
                #3b82f6, 
                #64748b
            );
        }

        .backend-status.connected::before {
            background: linear-gradient(90deg, 
                #10b981, 
                #34d399, 
                #10b981
            );
        }

        .backend-status.error::before {
            background: linear-gradient(90deg, 
                #ef4444, 
                #f87171, 
                #ef4444
            );
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #64748b;
            animation: pulse-dot 2s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.1);
            }
        }

        .status-text {
            color: #f8fafc;
            font-weight: 500;
            font-size: 0.9em;
        }

        .backend-status p {
            color: #cbd5e1;
            margin: 5px 0 0 22px;
            font-size: 0.8em;
            opacity: 0.8;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6, #1d4ed8);
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #1d4ed8, #1e40af);
        }

        /* å“åº”å¼è®¾è®¡ - å¤šæ–­ç‚¹é€‚é… */
        
        /* è¶…å¤§å±å¹• (1920px+) */
        @media (min-width: 1920px) {
            .container {
                max-width: 1800px;
                padding: 0 40px;
            }
            
            .left-panel {
                flex: 0 0 500px;
                padding: 40px;
            }
            
            .header h1 {
                font-size: 2.8em;
            }
            
            .radio-item {
                padding: 22px;
            }
            
            .process-btn {
                padding: 28px 38px;
                font-size: 22px;
            }
        }
        
        /* å¤§å±å¹• (1440px - 1919px) */
        @media (min-width: 1440px) and (max-width: 1919px) {
            .container {
                max-width: 1600px;
                padding: 0 30px;
            }
            
            .left-panel {
                flex: 0 0 480px;
                padding: 35px;
            }
            
            .header h1 {
                font-size: 2.6em;
            }
            
            .process-btn {
                padding: 26px 34px;
                font-size: 21px;
            }
        }
        
        /* ä¸­ç­‰å±å¹• (1024px - 1439px) */
        @media (min-width: 1024px) and (max-width: 1439px) {
            .container {
                max-width: 1200px;
                padding: 0 20px;
            }
            
            .left-panel {
                flex: 0 0 420px;
                padding: 25px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .process-btn {
                padding: 22px 28px;
                font-size: 18px;
            }
        }
        
        /* å¹³æ¿æ¨ªå± (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .container {
                flex-direction: row;
                max-width: 100%;
                padding: 0 15px;
            }
            
            .left-panel {
                flex: 0 0 350px;
                padding: 20px;
            }
            
            .right-panel {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .radio-item {
                padding: 16px;
            }
            
            .process-btn {
                padding: 20px 24px;
                font-size: 16px;
            }
            
            .result-preview-content {
                min-height: 300px;
            }
        }
        
        /* å¹³æ¿ç«–å±å’Œå°å±å¹• (480px - 767px) */
        @media (min-width: 480px) and (max-width: 767px) {
            .container {
                flex-direction: column;
                border-radius: 0;
                padding: 0;
            }

            .left-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid rgba(59, 130, 246, 0.3);
                padding: 20px;
            }

            .right-panel {
                padding: 15px;
            }

            .result-preview-section {
                margin-bottom: 15px;
                padding: 15px;
                min-height: 250px;
            }

            .result-details-section {
                padding: 15px;
            }

            .result-preview-content {
                min-height: 200px;
                padding: 15px;
            }

            .result-details-content {
                max-height: 200px;
            }

            .header h1 {
                font-size: 1.6em;
            }

            .file-upload-area {
                padding: 18px 15px;
            }

            .radio-item {
                padding: 14px;
            }

            .process-btn {
                padding: 18px 20px;
                font-size: 16px;
            }
        }
        
        /* æ‰‹æœº (max-width: 479px) */
        @media (max-width: 479px) {
            .container {
                flex-direction: column;
                border-radius: 0;
                padding: 0;
            }

            .left-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid rgba(59, 130, 246, 0.3);
                padding: 15px;
            }

            .right-panel {
                padding: 10px;
            }

            .result-preview-section {
                margin-bottom: 10px;
                padding: 10px;
                min-height: 200px;
            }

            .result-details-section {
                padding: 10px;
            }

            .result-preview-content {
                min-height: 180px;
                padding: 10px;
            }

            .result-details-content {
                max-height: 150px;
            }

            .preview-image-container {
                flex-direction: column !important;
                gap: 8px;
                padding: 5px;
            }

            .preview-image-container.horizontal,
            .preview-image-container.vertical {
                flex-direction: column !important;
            }

            .preview-image-item {
                max-width: 100%;
                min-width: auto;
            }

            .preview-image-container.horizontal .preview-image,
            .preview-image-container.vertical .preview-image {
                max-width: calc(100% - 10px);
                max-height: calc(35% - 25px);
                width: auto;
                height: auto;
            }

            .download-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .header h1 {
                font-size: 1.4em;
            }

            .file-upload-area {
                padding: 15px 10px;
            }

            .radio-item {
                padding: 12px;
            }

            .process-btn {
                padding: 16px 18px;
                font-size: 14px;
            }

            .placeholder-icon {
                font-size: 32px;
            }

            .placeholder-text h3 {
                font-size: 1em;
            }

            .preview-code-container {
                font-size: 10px;
                padding: 8px;
            }
            
            /* ä¼˜åŒ–å°å±å¹•ä¸Šçš„è¾“å…¥åŒºåŸŸ */
            .input-group input, 
            .input-group textarea, 
            .input-group select {
                padding: 12px 14px;
                font-size: 16px; /* é˜²æ­¢iOSç¼©æ”¾ */
            }
        }

        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        .touch-device .radio-item {
            min-height: 48px; /* ç¬¦åˆè§¦æ‘¸æ ‡å‡† */
        }
        
        .touch-device .process-btn {
            min-height: 48px;
        }
        
        .touch-device button {
            min-height: 44px;
            min-width: 44px;
        }
        
        .touch-device .file-upload-btn {
            min-height: 48px;
        }
        
        /* é«˜åˆ†è¾¨ç‡å±å¹•ä¼˜åŒ– */
        .retina {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .retina .radio-item {
            border-width: 0.5px;
        }
        
        /* æ·»åŠ ç„¦ç‚¹æ ·å¼ */
        button:focus, input:focus, select:focus {
            outline: 2px solid rgba(59, 130, 246, 0.5);
            outline-offset: 2px;
        }

        /* é€‰æ‹©æ¡†æ ·å¼ */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%233b82f6' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        /* æ·»åŠ å¾®å¦™çš„åŠ¨ç”»æ•ˆæœ */
        .radio-item, .input-group input, .input-group select, .process-btn, .download-btn {
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .process-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 24px 32px;
            border-radius: 16px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            margin-top: 0px;
            overflow: hidden;
            box-shadow: 
                0 8px 25px rgba(16, 185, 129, 0.4),
                0 0 0 1px rgba(16, 185, 129, 0.2);
            text-align: center;
        }

        .process-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent
            );
            transition: left 0.5s ease;
        }

        .process-btn:hover::before {
            left: 100%;
        }

        .process-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-3px);
            box-shadow: 
                0 12px 35px rgba(16, 185, 129, 0.5),
                0 0 0 1px rgba(16, 185, 129, 0.3);
        }

        .process-btn:disabled {
            background: linear-gradient(135deg, #374151, #1f2937);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.5;
        }

        .input-content {
            transition: all 0.2s ease-in-out;
        }

        .input-content.hidden {
            opacity: 0;
            transform: translateY(-10px);
        }

        .result-preview-section {
            flex: 2;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(59, 130, 246, 0.15);
            backdrop-filter: blur(10px);
        }

        .result-details-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(59, 130, 246, 0.15);
            backdrop-filter: blur(10px);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 8px 0;
            border-left: 3px solid #3b82f6;
            padding-left: 12px;
            background: linear-gradient(90deg, #3b82f6, transparent);
        }

        .preview-header h2 {
            color: #f8fafc;
            font-size: 1.5em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0;
        }

        .details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 6px 0;
            border-left: 2px solid rgba(59, 130, 246, 0.8);
            padding-left: 10px;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.6), transparent);
            border-radius: 0 4px 4px 0;
        }

        .details-header h3 {
            color: #f8fafc;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin: 0;
        }

        .result-preview-content {
            flex: 1;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }

        .result-details-content {
            flex: 1;
            overflow-y: auto;
            max-height: 250px;
        }

        .preview-placeholder {
            text-align: center;
            color: #cbd5e1;
        }

        .placeholder-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .placeholder-text h3 {
            color: #f1f5f9;
            margin-bottom: 8px;
            font-size: 1.3em;
            font-weight: 500;
        }

        .placeholder-text p {
            color: #94a3b8;
            font-size: 0.95em;
        }

        .details-placeholder {
            text-align: center;
            color: #94a3b8;
            padding: 40px 20px;
            font-style: italic;
        }

        /* é¢„è§ˆå†…å®¹æ ·å¼ */
        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
            background: white;
            min-height: 400px;
            z-index: 2;
            position: relative;
        }

        /* PDFå®¹å™¨ç‰¹æ®Šæ ·å¼ */
        .preview-pdf-container {
            position: relative;
            overflow: hidden;
        }

        .preview-pdf-container .pdf-fallback {
            pointer-events: none;
            user-select: none;
        }

        .preview-pdf-container iframe {
            display: block;
        }

        .preview-image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            gap: 15px;
            padding: 10px;
        }

        .preview-image-container.horizontal {
            flex-direction: row;
        }

        .preview-image-container.vertical {
            flex-direction: column;
        }

        .preview-image-item {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 0; /* å…è®¸æ”¶ç¼© */
        }

        .preview-image-item h4 {
            color: #f1f5f9;
            margin-bottom: 8px;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .preview-image {
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            object-fit: contain;
            background: rgba(255, 255, 255, 0.1);
        }

        /* æ°´å¹³æ’åˆ—æ—¶çš„å›¾ç‰‡æ ·å¼ */
        .preview-image-container.horizontal .preview-image {
            max-width: 100%;
            max-height: calc(100% - 30px); /* ä¸ºæ ‡é¢˜é¢„ç•™ç©ºé—´ */
            width: auto;
            height: auto;
        }

        /* å‚ç›´æ’åˆ—æ—¶çš„å›¾ç‰‡æ ·å¼ */
        .preview-image-container.vertical .preview-image {
            max-width: calc(100% - 20px);
            max-height: calc(50% - 40px); /* ä¸ºæ ‡é¢˜å’Œé—´è·é¢„ç•™ç©ºé—´ */
            width: auto;
            height: auto;
        }

        .preview-code-container {
            width: 100%;
            height: 100%;
            overflow: auto;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 6px;
            padding: 15px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: #e2e8f0;
        }

        .preview-pdf-container {
            width: 100%;
            height: 100%;
            background: #f8fafc;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #334155;
            font-size: 1.1em;
        }

        .download-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(59, 130, 246, 0.2);
        }

        .download-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .download-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 24px 32px;
            border-radius: 16px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 
                0 8px 25px rgba(16, 185, 129, 0.4),
                0 0 0 1px rgba(16, 185, 129, 0.2);
            min-width: 300px;
            overflow: hidden;
            position: relative;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-3px);
            box-shadow: 
                0 12px 35px rgba(16, 185, 129, 0.5),
                0 0 0 1px rgba(16, 185, 129, 0.3);
        }

        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent
            );
            transition: left 0.5s ease;
        }

        .download-btn:hover::before {
            left: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§é¢æ¿ -->
        <div class="left-panel">
            <div class="header">
                <h1>ç§»æ°‘ææ–™ç¿»è¯‘<span class="version-badge">V1.41</span></h1>
              
            </div>

            <!-- åç«¯è¿æ¥çŠ¶æ€ -->
            <div id="backend-status" class="backend-status">
                <div class="status-indicator">
                    <span class="status-dot" id="status-dot"></span>
                    <span class="status-text" id="status-text">åç«¯çŠ¶æ€æ£€æŸ¥ä¸­...</span>
                </div>
            </div>

            <!-- ç¿»è¯‘ç±»å‹é€‰æ‹© -->
            <div class="translation-options">
                <div class="option-group">
                    <div class="option-label">é€‰æ‹©ç¿»è¯‘ç±»å‹</div>
                    <div class="radio-group">

                        <div class="radio-item active" data-type="webpage-google">
                            <input type="radio" id="webpage-google" name="translationType" value="webpage-google" checked>
                            <label for="webpage-google">
                                ç½‘é¡µç¿»è¯‘
                                <div class="description">è¾“å…¥ç½‘é¡µé“¾æ¥å³å¯è·å¾—ç¿»è¯‘ç‰ˆç½‘é¡µ</div>
                            </label>
                        </div>
                        <!-- <div class="radio-item" data-type="webpage-gpt">
                            <input type="radio" id="webpage-gpt" name="translationType" value="webpage-gpt">
                            <label for="webpage-gpt">
                                ç½‘é¡µç¿»è¯‘ (æµ‹è¯•ç‰ˆ)
                                <div class="description">å¦‚æœç¨³å®šç‰ˆæ— æ³•æ­£ç¡®ç¿»è¯‘ç½‘é¡µï¼Œè¯·ä½¿ç”¨æµ‹è¯•ç‰ˆ</div>
                            </label>
                        </div> -->
                        <div class="radio-item" data-type="poster">
                            <input type="radio" id="poster" name="translationType" value="poster">
                            <label for="poster">
                                æµ·æŠ¥ç¿»è¯‘
                                <div class="description">å°†æµ·æŠ¥å†…å®¹è½¬æ¢ä¸ºå¯¹åº”çš„ç»“æ„åŒ–è¡¨æ ¼</div>
                            </label>
                        </div>
                        <div class="radio-item" data-type="baidu-image">
                            <input type="radio" id="baidu-image" name="translationType" value="baidu-image">
                            <label for="baidu-image">
                                å›¾ç‰‡ç¿»è¯‘
                                <div class="description">ä¸Šä¼ å›¾ç‰‡ä»¥è¿›è¡Œç¿»è¯‘ï¼Œè¯·å°½é‡ä¿è¯æ–‡å­—æ¸…æ™°</div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <!-- æµ·æŠ¥ç¿»è¯‘è¾“å…¥ -->
                <div id="poster-input" class="input-content hidden">
                    <div class="input-group">
                        <label class="sub-label">é€‰æ‹©æµ·æŠ¥æ–‡ä»¶</label>
                        <div class="file-upload-enhanced">
                            <input type="file" id="poster-file" accept=".png,.jpg,.jpeg,.bmp,.gif,.tiff" style="display: none;">
                            <div class="file-upload-area" onclick="document.getElementById('poster-file').click();">
                                <div class="file-upload-icon">FILE</div>
                                <div class="file-upload-text">
                                    <div class="primary-text">ç‚¹å‡»é€‰æ‹©æµ·æŠ¥æ–‡ä»¶</div>
                                    <div class="secondary-text">æ”¯æŒ PNG, JPG, JPEG, BMP, GIF, TIFF æ ¼å¼</div>
                                    <div class="file-size-hint">å»ºè®®æ–‡ä»¶å¤§å°å°äº10MB</div>
                                </div>
                                <div class="file-upload-btn">é€‰æ‹©æ–‡ä»¶</div>
                            </div>
                            <div id="poster-file-preview" class="file-preview hidden">
                                <div class="preview-header">
                                    <span class="preview-title">å·²é€‰æ‹©æ–‡ä»¶</span>
                                    <button type="button" class="remove-file-btn" onclick="removePosterFile()">âœ•</button>
                                </div>
                                <div class="preview-content">
                                    <div class="image-info-container">
                                        <img id="poster-preview-img" class="preview-image" alt="æµ·æŠ¥é¢„è§ˆ">
                                        <div class="file-info">
                                            <div id="poster-file-name" class="file-name"></div>
                                            <div id="poster-file-size" class="file-size"></div>
                                            <div id="poster-file-type" class="file-type"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Googleç½‘é¡µç¿»è¯‘è¾“å…¥ -->
                <div id="webpage-google-input" class="input-content">
                    <div class="input-group">
                        <label for="webpage-google-url" class="sub-label">è¾“å…¥ç½‘é¡µé“¾æ¥</label>
                        <input type="url" id="webpage-google-url" placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„ç½‘é¡µé“¾æ¥">
                    </div>
                </div>

                <!-- GPTç½‘é¡µç¿»è¯‘è¾“å…¥ -->
                <div id="webpage-gpt-input" class="input-content hidden">
                    <div class="input-group">
                        <label for="webpage-gpt-url" class="sub-label">è¾“å…¥ç½‘é¡µé“¾æ¥</label>
                        <input type="url" id="webpage-gpt-url" placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„ç½‘é¡µé“¾æ¥">
                    </div>
                </div>

                <!-- Baiduå›¾ç‰‡ç¿»è¯‘è¾“å…¥ -->
                <div id="baidu-image-input" class="input-content hidden">
                    <div style="display: flex; gap: 15px;">
                        <div class="input-group" style="flex: 1;">
                            <label for="baidu-from-lang">æºè¯­è¨€</label>
                            <select id="baidu-from-lang">
                                <option value="zh">ä¸­æ–‡ (Chinese)</option>
                                <option value="en">è‹±è¯­ (English)</option>
                                <option value="jp">æ—¥è¯­ (Japanese)</option>
                                <option value="ko">éŸ©è¯­ (Korean)</option>
                                <option value="es">è¥¿ç­ç‰™è¯­ (Spanish)</option>
                                <option value="fr">æ³•è¯­ (French)</option>
                                <option value="th">æ³°è¯­ (Thai)</option>
                                <option value="ar">é˜¿æ‹‰ä¼¯è¯­ (Arabic)</option>
                                <option value="ru">ä¿„è¯­ (Russian)</option>
                                <option value="pt">è‘¡è„ç‰™è¯­ (Portuguese)</option>
                                <option value="de">å¾·è¯­ (German)</option>
                                <option value="it">æ„å¤§åˆ©è¯­ (Italian)</option>
                                <option value="vi">è¶Šå—è¯­ (Vietnamese)</option>
                                <option value="hi">å°åœ°è¯­ (Hindi)</option>
                            </select>
                        </div>
                        <div class="input-group" style="flex: 1;">
                            <label for="baidu-to-lang">ç›®æ ‡è¯­è¨€</label>
                            <select id="baidu-to-lang">
                                <option value="en">è‹±è¯­ (English)</option>
                                <option value="zh">ä¸­æ–‡ (Chinese)</option>
                                <option value="jp">æ—¥è¯­ (Japanese)</option>
                                <option value="ko">éŸ©è¯­ (Korean)</option>
                                <option value="es">è¥¿ç­ç‰™è¯­ (Spanish)</option>
                                <option value="fr">æ³•è¯­ (French)</option>
                                <option value="th">æ³°è¯­ (Thai)</option>
                                <option value="ar">é˜¿æ‹‰ä¼¯è¯­ (Arabic)</option>
                                <option value="ru">ä¿„è¯­ (Russian)</option>
                                <option value="pt">è‘¡è„ç‰™è¯­ (Portuguese)</option>
                                <option value="de">å¾·è¯­ (German)</option>
                                <option value="it">æ„å¤§åˆ©è¯­ (Italian)</option>
                                <option value="vi">è¶Šå—è¯­ (Vietnamese)</option>
                                <option value="hi">å°åœ°è¯­ (Hindi)</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label class="sub-label">é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</label>
                        <div class="file-upload-enhanced">
                            <input type="file" id="baidu-image-file" accept=".png,.jpg,.jpeg,.bmp,.gif,.tiff" style="display: none;">
                            <div class="file-upload-area" onclick="document.getElementById('baidu-image-file').click();">
                                <div class="file-upload-icon">IMAGE</div>
                                <div class="file-upload-text">
                                    <div class="primary-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æ–‡ä»¶</div>
                                    <div class="secondary-text">æ”¯æŒ PNG, JPG, JPEG, BMP, GIF, TIFF æ ¼å¼</div>
                                    <div class="file-size-hint">å»ºè®®æ–‡ä»¶å¤§å°å°äº10MB</div>
                                </div>
                                <div class="file-upload-btn">é€‰æ‹©æ–‡ä»¶</div>
                            </div>
                            <div id="baidu-image-file-preview" class="file-preview hidden">
                                <div class="preview-header">
                                    <span class="preview-title">å·²é€‰æ‹©æ–‡ä»¶</span>
                                    <button type="button" class="remove-file-btn" onclick="removeBaiduImageFile()">âœ•</button>
                                </div>
                                <div class="preview-content">
                                    <div class="image-info-container">
                                        <img id="baidu-image-preview-img" class="preview-image" alt="å›¾ç‰‡é¢„è§ˆ">
                                        <div class="file-info">
                                            <div id="baidu-image-file-name" class="file-name"></div>
                                            <div id="baidu-image-file-size" class="file-size"></div>
                                            <div id="baidu-image-file-type" class="file-type"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="process-btn" onclick="processTranslation()" id="process-btn">å¼€å§‹ç¿»è¯‘</button>
            </div>

            <!-- çŠ¶æ€æ¶ˆæ¯ -->
            <div id="status-message" class="status-message"></div>


        </div>

        <!-- å³ä¾§é¢æ¿ -->
        <div class="right-panel">
            <!-- ä¸Šæ–¹ï¼šç»“æœé¢„è§ˆåŒºåŸŸ -->
            <div class="result-preview-section">
                <div class="preview-header">
                    <h2>ç¿»è¯‘ç»“æœé¢„è§ˆ</h2>
                </div>

                <div id="result-preview" class="result-preview-content">
                    <div class="preview-placeholder">
                        <div class="placeholder-icon">Â·Â·Â·</div>
                        <div class="placeholder-text">
                            <h3>ç­‰å¾…ç¿»è¯‘ç»“æœ</h3>
                            <p>è¯·é€‰æ‹©ç¿»è¯‘ç±»å‹å¹¶æä¾›å†…å®¹ä»¥å¼€å§‹ç¿»è¯‘</p>
                        </div>
                    </div>
                    
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <p id="loading-text">ç¿»è¯‘å¤„ç†ä¸­...</p>
                        </div>
                </div>
            </div>

            <!-- ä¸‹æ–¹ï¼šç»“æœä¿¡æ¯åˆ—è¡¨ -->
            <div class="result-details-section">
                <div class="details-header">
                    <h3>å¤„ç†è¯¦æƒ…</h3>
                </div>
                
                <div id="result-details" class="result-details-content">
                    <div class="details-placeholder">
                        <p>ç¿»è¯‘å®Œæˆåå°†åœ¨æ­¤æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p>
                    </div>
                </div>

                <div class="download-section">
                    <div class="download-buttons">
                        <button class="download-btn" id="download-main-btn" onclick="downloadMain()">ä¸‹è½½ç»“æœ</button>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTranslationType = 'webpage-google';
        let translationResult = null;
        // let backendUrl = 'https://file-translation.zacchen.win';
        //æµ‹è¯•
        let backendUrl = 'https://filetrans2.0.drziangchen.uk';
        let logUpdateInterval = null;

        // å±å¹•åˆ†è¾¨ç‡æ£€æµ‹å’Œè‡ªé€‚åº”å¸ƒå±€
        function detectScreenSize() {
            const width = window.innerWidth;
            const height = window.innerHeight;
            const dpr = window.devicePixelRatio || 1;
            const screenType = getScreenType(width);
            
            return {
                width,
                height,
                dpr,
                screenType,
                isRetina: dpr > 1,
                isLandscape: width > height,
                aspectRatio: (width / height).toFixed(2)
            };
        }
        
        function getScreenType(width) {
            if (width >= 1920) return 'ultra-wide';
            if (width >= 1440) return 'large';
            if (width >= 1024) return 'medium';
            if (width >= 768) return 'tablet-landscape';
            if (width >= 480) return 'tablet-portrait';
            return 'mobile';
        }
        
        function applyAdaptiveLayout() {
            const screenInfo = detectScreenSize();
            const body = document.body;
            
            // ç§»é™¤æ‰€æœ‰ä¹‹å‰çš„å±å¹•ç±»å‹ç±»
            body.classList.remove('ultra-wide', 'large', 'medium', 'tablet-landscape', 'tablet-portrait', 'mobile');
            body.classList.remove('retina', 'landscape', 'portrait');
            
            // æ·»åŠ å½“å‰å±å¹•ç±»å‹ç±»
            body.classList.add(screenInfo.screenType);
            
            if (screenInfo.isRetina) {
                body.classList.add('retina');
            }
            
            if (screenInfo.isLandscape) {
                body.classList.add('landscape');
            } else {
                body.classList.add('portrait');
            }
            
            // è®¾ç½®CSSè‡ªå®šä¹‰å±æ€§
            document.documentElement.style.setProperty('--screen-width', screenInfo.width + 'px');
            document.documentElement.style.setProperty('--screen-height', screenInfo.height + 'px');
            document.documentElement.style.setProperty('--device-pixel-ratio', screenInfo.dpr);
            document.documentElement.style.setProperty('--aspect-ratio', screenInfo.aspectRatio);
            
            // åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°
            adjustFontSizes(screenInfo);
            
            // åŠ¨æ€è°ƒæ•´å®¹å™¨å¸ƒå±€
            adjustContainerLayout(screenInfo);
            
            console.log('ğŸ“± å±å¹•ä¿¡æ¯:', {
                å°ºå¯¸: `${screenInfo.width}x${screenInfo.height}`,
                ç±»å‹: screenInfo.screenType,
                åƒç´ æ¯”: screenInfo.dpr,
                æ–¹å‘: screenInfo.isLandscape ? 'æ¨ªå±' : 'ç«–å±',
                é«˜åˆ†è¾¨ç‡: screenInfo.isRetina ? 'æ˜¯' : 'å¦'
            });
        }
        
        function adjustFontSizes(screenInfo) {
            const baseSize = calculateBaseFontSize(screenInfo);
            document.documentElement.style.setProperty('--base-font-size', baseSize + 'px');
            
            // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´æ ¹å­—ä½“å¤§å°
            if (screenInfo.width <= 479) {
                document.documentElement.style.fontSize = '14px';
            } else if (screenInfo.width <= 767) {
                document.documentElement.style.fontSize = '15px';
            } else if (screenInfo.width <= 1023) {
                document.documentElement.style.fontSize = '16px';
            } else if (screenInfo.width <= 1439) {
                document.documentElement.style.fontSize = '17px';
            } else {
                document.documentElement.style.fontSize = '18px';
            }
        }
        
        function calculateBaseFontSize(screenInfo) {
            const minSize = 14;
            const maxSize = 20;
            const minWidth = 320;
            const maxWidth = 1920;
            
            const ratio = Math.min(Math.max((screenInfo.width - minWidth) / (maxWidth - minWidth), 0), 1);
            return Math.round(minSize + (maxSize - minSize) * ratio);
        }
        
        function adjustContainerLayout(screenInfo) {
            const container = document.querySelector('.container');
            const leftPanel = document.querySelector('.left-panel');
            
            if (!container || !leftPanel) return;
            
            // è¶…å¤§å±å¹•ä¼˜åŒ–
            if (screenInfo.screenType === 'ultra-wide') {
                container.style.maxWidth = '1800px';
                if (screenInfo.width >= 2560) {
                    leftPanel.style.flex = '0 0 600px';
                }
            }
            
            // ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–
            if (screenInfo.screenType === 'mobile') {
                // ä¼˜åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨æ€§èƒ½
                container.style.webkitOverflowScrolling = 'touch';
                container.style.overflowY = 'auto';
            }
        }
        
        function optimizeForMobile() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            
            if (isMobile || isTouchDevice) {
                document.body.classList.add('touch-device');
                
                // ä¼˜åŒ–è§¦æ‘¸ä½“éªŒ
                const radioItems = document.querySelectorAll('.radio-item');
                radioItems.forEach(item => {
                    item.style.touchAction = 'manipulation';
                });
                
                // é˜²æ­¢iOSåŒå‡»ç¼©æ”¾
                const buttons = document.querySelectorAll('button');
                buttons.forEach(button => {
                    button.style.touchAction = 'manipulation';
                });
            }
        }
        
        // ç›‘å¬å±å¹•å°ºå¯¸å˜åŒ–
        function setupResizeListener() {
            let resizeTimeout;
            
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    applyAdaptiveLayout();
                    
                    // é‡æ–°ä¼˜åŒ–å›¾ç‰‡å¸ƒå±€
                    const imageContainers = document.querySelectorAll('[id^="image-container-"]');
                    imageContainers.forEach(container => {
                        const containerId = container.id;
                        setTimeout(() => optimizeImageLayout(containerId), 100);
                    });
                }, 150);
            });
            
            // ç›‘å¬è®¾å¤‡æ–¹å‘å˜åŒ–
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    applyAdaptiveLayout();
                }, 300);
            });
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            checkBackendStatus(); // åˆå§‹æ£€æŸ¥
            
            // è®¾ç½®å‘¨æœŸæ€§åç«¯çŠ¶æ€æ£€æŸ¥ï¼ˆæ¯10ç§’ä¸€æ¬¡ï¼‰
            setInterval(checkBackendStatus, 10000);
            
            // åˆå§‹åŒ–è‡ªé€‚åº”å¸ƒå±€
            applyAdaptiveLayout();
            setupResizeListener();
            optimizeForMobile();
            
            // ç¡®ä¿æ˜¾ç¤ºæ­£ç¡®çš„é»˜è®¤è¾“å…¥åŒºåŸŸ
            updateInputSection();
            updateRadioItemStyles();
            
            // æ£€æŸ¥PDFæ”¯æŒ
            const pdfSupported = checkPdfSupport();
            console.log('æµè§ˆå™¨PDFæ”¯æŒçŠ¶æ€:', pdfSupported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ');
            
            if (!pdfSupported) {
                console.warn('âš ï¸ æ‚¨çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒPDFé¢„è§ˆï¼Œå»ºè®®ä½¿ç”¨Chromeã€Firefoxæˆ–Edgeæµè§ˆå™¨');
                addLogEntry('æµè§ˆå™¨PDFæ”¯æŒå—é™ï¼Œå»ºè®®ä½¿ç”¨Chromeæµè§ˆå™¨', 'warning');
            } else {
                addLogEntry('æµè§ˆå™¨PDFæ”¯æŒæ­£å¸¸', 'success');
            }
            
            // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            console.log('ğŸ”§ è°ƒè¯•å·¥å…·å·²åŠ è½½:');
            console.log('  - debugPdfFiles() - æŸ¥çœ‹å¯ç”¨PDFæ–‡ä»¶');
            console.log('  - testPdfPreview(url) - æµ‹è¯•PDFé¢„è§ˆURL');
            console.log('  - testCurrentPdf() - æµ‹è¯•å½“å‰ç¿»è¯‘ç»“æœçš„PDF');
            console.log('  - testPdfInfrastructure() - æµ‹è¯•PDFé¢„è§ˆåŸºç¡€è®¾æ–½');
            console.log('  - checkPdfSupport() - æ£€æŸ¥PDFæ”¯æŒ');
            console.log('  - applyAdaptiveLayout() - é‡æ–°åº”ç”¨è‡ªé€‚åº”å¸ƒå±€');
            console.log('  - detectScreenSize() - æ£€æµ‹å½“å‰å±å¹•ä¿¡æ¯');
            console.log('ğŸ’¡ æç¤º: ç¿»è¯‘å®Œæˆåå¯ä½¿ç”¨æ§åˆ¶å°å‘½ä»¤è¿›è¡Œè°ƒè¯•');
            console.log('ğŸ§ª å¦‚æœPDFé¢„è§ˆæœ‰é—®é¢˜ï¼Œè¯·å…ˆè¿è¡Œ testPdfInfrastructure() è¿›è¡ŒåŸºç¡€æµ‹è¯•');
            
            const screenInfo = detectScreenSize();
            addLogEntry(`ç§»æ°‘ææ–™ç¿»è¯‘å¹³å°å‰ç«¯å·²åŠ è½½ - å“åº”å¼ç‰ˆ v3.0 (${screenInfo.width}x${screenInfo.height})`, 'success');
            addLogEntry(`å½“å‰å±å¹•ç±»å‹: ${screenInfo.screenType} (${screenInfo.isLandscape ? 'æ¨ªå±' : 'ç«–å±'})`, 'info');
            addLogEntry('è‡ªé€‚åº”å¸ƒå±€å·²å¯ç”¨ï¼Œæ”¯æŒå¤šç§å±å¹•å°ºå¯¸', 'success');
        });

        // å¤„ç†æµ·æŠ¥æ–‡ä»¶é€‰æ‹©
        function handlePosterFileSelect(input) {
            const file = input.files[0];
            const preview = document.getElementById('poster-file-preview');
            const uploadArea = document.querySelector('.file-upload-area');
            
            if (file) {
                // éªŒè¯æ–‡ä»¶å¤§å°
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    alert(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ${(file.size/1024/1024).toFixed(2)}MB > 10MBï¼‰`);
                    input.value = '';
                    return;
                }
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/bmp', 'image/gif', 'image/tiff'];
                if (!allowedTypes.includes(file.type)) {
                    alert(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.type}`);
                    input.value = '';
                    return;
                }
                
                // æ˜¾ç¤ºé¢„è§ˆ
                preview.classList.remove('hidden');
                uploadArea.style.display = 'none';
                
                // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
                document.getElementById('poster-file-name').textContent = file.name;
                document.getElementById('poster-file-size').textContent = `${(file.size/1024).toFixed(2)} KB`;
                document.getElementById('poster-file-type').textContent = file.type;
                
                // æ˜¾ç¤ºå›¾åƒé¢„è§ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('poster-preview-img').src = e.target.result;
                    // ä¸ºé¢„è§ˆå®¹å™¨æ·»åŠ å›¾ç‰‡é¢„è§ˆæ ·å¼ç±»
                    const previewContent = preview.querySelector('.preview-content');
                    if (previewContent) {
                        previewContent.classList.add('image-preview');
                    }
                };
                reader.readAsDataURL(file);
            } else {
                // éšè—é¢„è§ˆ
                preview.classList.add('hidden');
                uploadArea.style.display = 'block';
            }
        }

        // ç§»é™¤æµ·æŠ¥æ–‡ä»¶
        function removePosterFile() {
            const input = document.getElementById('poster-file');
            const preview = document.getElementById('poster-file-preview');
            const uploadArea = document.querySelector('.file-upload-area');
            
            input.value = '';
            preview.classList.add('hidden');
            uploadArea.style.display = 'block';
            
            // ç§»é™¤å›¾ç‰‡é¢„è§ˆæ ·å¼ç±»
            const previewContent = preview.querySelector('.preview-content');
            if (previewContent) {
                previewContent.classList.remove('image-preview');
            }
        }

        // å¤„ç†ç™¾åº¦å›¾ç‰‡æ–‡ä»¶é€‰æ‹©
        function handleBaiduImageFileSelect(input) {
            const file = input.files[0];
            const preview = document.getElementById('baidu-image-file-preview');
            const uploadArea = document.querySelector('#baidu-image-input .file-upload-area');
            
            if (file) {
                // éªŒè¯æ–‡ä»¶å¤§å°
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    alert(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ${(file.size/1024/1024).toFixed(2)}MB > 10MBï¼‰`);
                    input.value = '';
                    return;
                }
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/bmp', 'image/gif', 'image/tiff'];
                if (!allowedTypes.includes(file.type)) {
                    alert(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.type}`);
                    input.value = '';
                    return;
                }
                
                // æ˜¾ç¤ºé¢„è§ˆ
                preview.classList.remove('hidden');
                uploadArea.style.display = 'none';
                
                // æ›´æ–°æ–‡ä»¶ä¿¡æ¯
                document.getElementById('baidu-image-file-name').textContent = file.name;
                document.getElementById('baidu-image-file-size').textContent = `${(file.size/1024).toFixed(2)} KB`;
                document.getElementById('baidu-image-file-type').textContent = file.type;
                
                // æ˜¾ç¤ºå›¾åƒé¢„è§ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('baidu-image-preview-img').src = e.target.result;
                    // ä¸ºé¢„è§ˆå®¹å™¨æ·»åŠ å›¾ç‰‡é¢„è§ˆæ ·å¼ç±»
                    const previewContent = preview.querySelector('.preview-content');
                    if (previewContent) {
                        previewContent.classList.add('image-preview');
                    }
                };
                reader.readAsDataURL(file);
            } else {
                // éšè—é¢„è§ˆ
                preview.classList.add('hidden');
                uploadArea.style.display = 'block';
            }
        }

        // ç§»é™¤ç™¾åº¦å›¾ç‰‡æ–‡ä»¶
        function removeBaiduImageFile() {
            const input = document.getElementById('baidu-image-file');
            const preview = document.getElementById('baidu-image-file-preview');
            const uploadArea = document.querySelector('#baidu-image-input .file-upload-area');
            
            input.value = '';
            preview.classList.add('hidden');
            uploadArea.style.display = 'block';
            
            // ç§»é™¤å›¾ç‰‡é¢„è§ˆæ ·å¼ç±»
            const previewContent = preview.querySelector('.preview-content');
            if (previewContent) {
                previewContent.classList.remove('image-preview');
            }
        }

        function setupEventListeners() {
            // ç¿»è¯‘ç±»å‹é€‰æ‹©
            document.querySelectorAll('input[name="translationType"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    currentTranslationType = this.value;
                    updateInputSection();
                    updateRadioItemStyles();
                });
            });

            // æ–‡ä»¶ä¸Šä¼ æŒ‰é’®
            document.querySelectorAll('.file-upload input[type="file"]').forEach(input => {
                input.addEventListener('change', function() {
                    updateFileUploadButton(this);
                });
            });

            // æµ·æŠ¥æ–‡ä»¶é€‰æ‹©
            const posterFileInput = document.getElementById('poster-file');
            if (posterFileInput) {
                posterFileInput.addEventListener('change', function() {
                    handlePosterFileSelect(this);
                });
            }

            // ç™¾åº¦å›¾ç‰‡æ–‡ä»¶é€‰æ‹©
            const baiduImageFileInput = document.getElementById('baidu-image-file');
            if (baiduImageFileInput) {
                baiduImageFileInput.addEventListener('change', function() {
                    handleBaiduImageFileSelect(this);
                });
            }
        }

        async function checkBackendStatus() {
            const statusEl = document.getElementById('backend-status');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            try {
                const response = await fetch(`${backendUrl}/api/test`);
                if (response.ok) {
                    const data = await response.json();
                    statusEl.className = 'backend-status connected';
                    statusDot.style.backgroundColor = '#10b981';
                    statusText.textContent = 'åç«¯è¿æ¥æ­£å¸¸';
                } else {
                    throw new Error('è¿æ¥å¤±è´¥');
                }
            } catch (error) {
                statusEl.className = 'backend-status error';
                statusDot.style.backgroundColor = '#ef4444';
                statusText.textContent = 'åç«¯è¿æ¥å¤±è´¥';
            }
        }

        function updateRadioItemStyles() {
            document.querySelectorAll('.radio-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.radio-item[data-type="${currentTranslationType}"]`).classList.add('active');
        }

        function updateInputSection() {
            // å¿«é€Ÿéšè—æ‰€æœ‰è¾“å…¥åŒºåŸŸ
            document.querySelectorAll('.input-content').forEach(content => {
                content.classList.add('hidden');
            });

            // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºå¯¹åº”çš„è¾“å…¥åŒºåŸŸï¼Œåˆ›å»ºå¹³æ»‘è¿‡æ¸¡
            setTimeout(() => {
                const targetElement = document.getElementById(`${currentTranslationType}-input`);
                if (targetElement) {
                    targetElement.classList.remove('hidden');
                }
            }, 100);
            
            // é‡ç½®é¢„è§ˆåŒºåŸŸ
            resetPreview();
        }

        function updateFileUploadButton(input) {
            const button = input.nextElementSibling;
            if (input.files.length > 0) {
                button.textContent = `ğŸ“ å·²é€‰æ‹©: ${input.files[0].name}`;
                button.style.background = '#28a745';
            } else {
                button.textContent = 'ğŸ“ é€‰æ‹©æ–‡ä»¶';
                button.style.background = '#667eea';
            }
        }

        function showLoading(text = 'ç¿»è¯‘å¤„ç†ä¸­...') {
            document.getElementById('loading-text').textContent = text;
            document.getElementById('loading').classList.add('show');
            document.querySelectorAll('.download-btn').forEach(btn => btn.style.display = 'none');
            document.getElementById('process-btn').disabled = true;
            hideStatusMessage();
            
            // éšè—å ä½ç¬¦å†…å®¹ï¼Œé¿å…ä¸åŠ è½½çŠ¶æ€é‡å 
            const placeholders = document.querySelectorAll('.preview-placeholder');
            placeholders.forEach(placeholder => {
                placeholder.style.display = 'none';
            });
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
            document.getElementById('process-btn').disabled = false;
            
            // å¦‚æœæ²¡æœ‰ç¿»è¯‘ç»“æœï¼Œé‡æ–°æ˜¾ç¤ºå ä½ç¬¦
            if (!translationResult) {
                const placeholders = document.querySelectorAll('.preview-placeholder');
                placeholders.forEach(placeholder => {
                    placeholder.style.display = 'block';
                });
            }
        }

        function showStatusMessage(message, type) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
        }

        function hideStatusMessage() {
            document.getElementById('status-message').style.display = 'none';
        }

        function showLogContainer() {
            const logContainer = document.getElementById('log-container');
            if (logContainer) {
                logContainer.classList.add('show');
            }
        }

        function hideLogContainer() {
            const logContainer = document.getElementById('log-container');
            if (logContainer) {
                logContainer.classList.remove('show');
            }
        }

        function addLogEntry(message, type = 'info') {
            const logContent = document.getElementById('log-content');
            if (!logContent) return; // å¦‚æœæ—¥å¿—å®¹å™¨ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            // ç®€åŒ–çš„æ—¥å¿—æ ¼å¼ï¼Œç§»é™¤emoji
            const prefix = {
                'info': '[INFO]',
                'success': '[SUCCESS]',
                'warning': '[WARNING]',
                'error': '[ERROR]',
                'debug': '[DEBUG]'
            };
            
            logEntry.textContent = `[${timestamp}] ${prefix[type] || '[INFO]'} ${message}`;
            logContent.appendChild(logEntry);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            logContent.scrollTop = logContent.scrollHeight;
        }

        function clearLogs() {
            const logContent = document.getElementById('log-content');
            if (logContent) {
                logContent.innerHTML = '';
            }
        }

        function resetPreview() {
            const resultPreview = document.getElementById('result-preview');
            const resultDetails = document.getElementById('result-details');
            
            // é‡ç½®é¢„è§ˆåŒºåŸŸ
            resultPreview.innerHTML = `
                <div class="preview-placeholder">
                    <div class="placeholder-icon">Â·Â·Â·</div>
                    <div class="placeholder-text">
                        <h3>ç­‰å¾…ç¿»è¯‘ç»“æœ</h3>
                        <p>è¯·é€‰æ‹©ç¿»è¯‘ç±»å‹å¹¶æä¾›å†…å®¹ä»¥å¼€å§‹ç¿»è¯‘</p>
                    </div>
                </div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p id="loading-text">ç¿»è¯‘å¤„ç†ä¸­...</p>
                </div>
            `;
            
            // é‡ç½®è¯¦æƒ…åŒºåŸŸ
            resultDetails.innerHTML = `
                <div class="details-placeholder">
                    <p>ç¿»è¯‘å®Œæˆåå°†åœ¨æ­¤æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p>
                </div>
            `;
            
            document.querySelectorAll('.download-btn').forEach(btn => btn.style.display = 'none');
            translationResult = null;
            hideLogContainer();
            clearLogs();
        }

        async function processTranslation() {
            try {
                showLoading();
                clearLogs();
                showLogContainer();
                addLogEntry('å¼€å§‹ç¿»è¯‘æµç¨‹', 'info');
                
                let isValid = false;
                let requestData = {};
                let endpoint = '';
                let method = 'POST';
                let isFormData = false;

                // éªŒè¯è¾“å…¥å¹¶æ”¶é›†æ•°æ®
                switch (currentTranslationType) {
                    case 'poster':
                        addLogEntry('éªŒè¯æµ·æŠ¥ç¿»è¯‘è¾“å…¥', 'debug');
                        const posterFile = document.getElementById('poster-file').files[0];
                        
                        if (!posterFile) {
                            throw new Error('è¯·é€‰æ‹©æµ·æŠ¥æ–‡ä»¶');
                        }
                        
                        // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶10MBï¼‰
                        const maxSize = 10 * 1024 * 1024; // 10MB
                        if (posterFile.size > maxSize) {
                            throw new Error(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ${(posterFile.size/1024/1024).toFixed(2)}MB > 10MBï¼‰`);
                        }
                        
                        // éªŒè¯æ–‡ä»¶ç±»å‹
                        const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/bmp', 'image/gif', 'image/tiff'];
                        if (!allowedTypes.includes(posterFile.type)) {
                            throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${posterFile.type}`);
                        }

                        addLogEntry(`é€‰æ‹©çš„æ–‡ä»¶: ${posterFile.name}`, 'info');
                        addLogEntry(`æ–‡ä»¶å¤§å°: ${(posterFile.size/1024).toFixed(2)} KB`, 'info');
                        addLogEntry(`æ–‡ä»¶ç±»å‹: ${posterFile.type}`, 'info');
                        addLogEntry('ä½¿ç”¨åç«¯é…ç½®çš„APIå¯†é’¥', 'debug');
                        addLogEntry('å‡†å¤‡è°ƒç”¨æµ·æŠ¥ç¿»è¯‘APIï¼ˆå¢å¼ºç‰ˆï¼‰', 'info');

                        const posterFormData = new FormData();
                        posterFormData.append('image', posterFile);
                        
                        requestData = posterFormData;
                        endpoint = '/api/poster-translate';
                        isFormData = true;
                        isValid = true;
                        showLoading('æµ·æŠ¥ç¿»è¯‘ä¸­...');
                        break;
                    
                    case 'webpage-gpt':
                        addLogEntry('éªŒè¯GPTç½‘é¡µç¿»è¯‘è¾“å…¥', 'debug');
                        const gptUrl = document.getElementById('webpage-gpt-url').value.trim();
                        
                        if (!gptUrl) {
                            throw new Error('è¯·è¾“å…¥ç½‘é¡µé“¾æ¥');
                        }

                        addLogEntry(`ç›®æ ‡URL: ${gptUrl}`, 'info');
                        addLogEntry('ä½¿ç”¨åç«¯é…ç½®çš„APIå¯†é’¥', 'debug');
                        addLogEntry('å‡†å¤‡è°ƒç”¨GPTç¿»è¯‘APIï¼ˆå¢å¼ºç‰ˆï¼‰', 'info');

                        requestData = {
                            url: gptUrl
                        };
                        
                        endpoint = '/api/webpage-gpt-translate';
                        isValid = true;
                        showLoading('ç½‘é¡µç¿»è¯‘ä¸­...');
                        break;
                    
                    case 'webpage-google':
                        addLogEntry('éªŒè¯Googleç½‘é¡µç¿»è¯‘è¾“å…¥', 'debug');
                        const googleUrl = document.getElementById('webpage-google-url').value.trim();
                        
                        if (!googleUrl) {
                            throw new Error('è¯·è¾“å…¥ç½‘é¡µé“¾æ¥');
                        }

                        addLogEntry(`ç›®æ ‡URL: ${googleUrl}`, 'info');
                        addLogEntry('å‡†å¤‡è°ƒç”¨Googleç¿»è¯‘API', 'info');

                        requestData = {
                            url: googleUrl
                        };
                        
                        endpoint = '/api/webpage-google-translate';
                        isValid = true;
                        showLoading('ç½‘é¡µç¿»è¯‘ä¸­...');
                        break;

                    case 'baidu-image':
                        addLogEntry('éªŒè¯ç™¾åº¦å›¾ç‰‡ç¿»è¯‘è¾“å…¥', 'debug');
                        const baiduFromLang = document.getElementById('baidu-from-lang').value;
                        const baiduToLang = document.getElementById('baidu-to-lang').value;
                        const baiduImageFile = document.getElementById('baidu-image-file').files[0];

                        if (!baiduImageFile) {
                            throw new Error('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                        }

                        // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶10MBï¼‰
                        const maxBaiduSize = 10 * 1024 * 1024; // 10MB
                        if (baiduImageFile.size > maxBaiduSize) {
                            throw new Error(`æ–‡ä»¶å¤§å°è¶…è¿‡é™åˆ¶ï¼ˆ${(baiduImageFile.size/1024/1024).toFixed(2)}MB > 10MBï¼‰`);
                        }

                        // éªŒè¯æ–‡ä»¶ç±»å‹
                        const allowedBaiduTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/bmp', 'image/gif', 'image/tiff'];
                        if (!allowedBaiduTypes.includes(baiduImageFile.type)) {
                            throw new Error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${baiduImageFile.type}`);
                        }

                        addLogEntry(`é€‰æ‹©çš„æ–‡ä»¶: ${baiduImageFile.name}`, 'info');
                        addLogEntry(`æ–‡ä»¶å¤§å°: ${(baiduImageFile.size/1024).toFixed(2)} KB`, 'info');
                        addLogEntry(`ç¿»è¯‘æ–¹å‘: ${baiduFromLang} -> ${baiduToLang}`, 'info');
                        addLogEntry('ä½¿ç”¨åç«¯é…ç½®çš„APIå¯†é’¥', 'debug');
                        addLogEntry('å‡†å¤‡è°ƒç”¨ç™¾åº¦å›¾ç‰‡ç¿»è¯‘API', 'info');

                        const baiduFormData = new FormData();
                        baiduFormData.append('image', baiduImageFile);
                        baiduFormData.append('from_lang', baiduFromLang);
                        baiduFormData.append('to_lang', baiduToLang);
                        baiduFormData.append('save_image', 'true');
                        
                        requestData = baiduFormData;
                        endpoint = '/api/image-translate';
                        isFormData = true;
                        isValid = true;
                        showLoading('å›¾ç‰‡ç¿»è¯‘ä¸­...');
                        break;
                }

                if (!isValid) {
                    throw new Error('è¯·æä¾›æœ‰æ•ˆçš„è¾“å…¥å†…å®¹');
                }

                // è°ƒç”¨åç«¯API
                addLogEntry('å‘é€è¯·æ±‚åˆ°åç«¯æœåŠ¡', 'info');
                const response = await callBackendAPI(endpoint, requestData, isFormData);
                
                if (response.success) {
                    addLogEntry('åç«¯å¤„ç†æˆåŠŸ', 'success');
                    addLogEntry('æ­£åœ¨æ˜¾ç¤ºç¿»è¯‘ç»“æœ', 'info');
                    displayResult(response);
                    showStatusMessage('ç¿»è¯‘å®Œæˆï¼', 'success');
                    addLogEntry('ç¿»è¯‘æµç¨‹å®Œæˆ', 'success');
                } else {
                    addLogEntry(`åç«¯è¿”å›é”™è¯¯: ${response.error}`, 'error');
                    throw new Error(response.error || 'ç¿»è¯‘å¤±è´¥');
                }
                
            } catch (error) {
                hideLoading();
                addLogEntry(`å¤„ç†å¤±è´¥: ${error.message}`, 'error');
                showStatusMessage(error.message, 'error');
                console.error('Translation error:', error);
            }
        }

        async function callBackendAPI(endpoint, data, isFormData = false) {
            const url = `${backendUrl}${endpoint}`;
            
            const options = {
                method: 'POST',
                body: isFormData ? data : JSON.stringify(data)
            };

            if (!isFormData) {
                options.headers = {
                    'Content-Type': 'application/json'
                };
            }

            const response = await fetch(url, options);
            return await response.json();
        }

        // function displayResult(result) {
        //     hideLoading();

        //     // ç”Ÿæˆé¢„è§ˆå†…å®¹
        //     const previewContent = generatePreviewContent(result);
            
        //     // ç”Ÿæˆè¯¦æƒ…å†…å®¹
        //     const detailsContent = generateDetailsContent(result);
            
        //     // æ›´æ–°é¢„è§ˆåŒºåŸŸ
        //     const resultPreview = document.getElementById('result-preview');
        //     resultPreview.innerHTML = previewContent;
            
        //     // æ›´æ–°è¯¦æƒ…åŒºåŸŸ
        //     const resultDetails = document.getElementById('result-details');
        //     resultDetails.innerHTML = detailsContent;

        //     // ä¿å­˜ç»“æœæ•°æ®
        //     translationResult = result;

        //     // æ˜¾ç¤ºç›¸åº”çš„ä¸‹è½½æŒ‰é’®
        //     showDownloadButtons(result);
            
        //     // å¦‚æœæœ‰PDFé¢„è§ˆï¼Œæµ‹è¯•URLå¯è®¿é—®æ€§
        //     if ((currentTranslationType === 'poster' && result.pdf_generated) ||
        //         (currentTranslationType.startsWith('webpage') && result.download_url)) {
        //         setTimeout(() => testPdfUrls(result), 1000);
        //     }
        // }

        function displayResult(result) {
        hideLoading();
        translationResult = result; // ä¿å­˜ç»“æœä»¥ä¾›ä¸‹è½½

        const resultPreview = document.getElementById('result-preview');
        const resultDetails = document.getElementById('result-details');
        
        let previewContent = '';
        let detailsContent = '';

        try {
            // --- æ ¹æ®ä¸åŒçš„ç¿»è¯‘ç±»å‹ç”Ÿæˆé¢„è§ˆå’Œè¯¦æƒ… ---
            const filename = result.pdf_filename || result.translated_filename;
            if (!filename) {
                // å¦‚æœåç«¯æ²¡æœ‰è¿”å›æœ‰æ•ˆçš„æ–‡ä»¶åï¼Œåˆ™æ˜¾ç¤ºé”™è¯¯
                if (currentTranslationType === 'baidu-image' && result.has_translated_image === false) {
                     // å›¾ç‰‡ç¿»è¯‘åªè¿”å›æ–‡æœ¬ï¼Œæ˜¯æ­£å¸¸æƒ…å†µ
                } else {
                    throw new Error(result.error || 'åç«¯æœªè¿”å›æœ‰æ•ˆçš„æ–‡ä»¶åã€‚');
                }
            }
            
            // --- å…³é”®ä¿®æ­£ï¼šå¯¹æ‰€æœ‰æ–‡ä»¶åè¿›è¡ŒURLç¼–ç  ---
            const encodedFilename = encodeURIComponent(filename);
            let previewUrlPath = '';

            if (currentTranslationType === 'poster') {
                previewUrlPath = `/preview/poster/${encodedFilename}`;
            } else if (currentTranslationType === 'webpage-google') {
                previewUrlPath = `/preview/translated/${encodedFilename}`;
            } else if (currentTranslationType === 'webpage-gpt') {
                const folder = result.folder_name;
                previewUrlPath = `/preview/workflow/${folder}/${encodedFilename}`;
            }

            if (previewUrlPath) {
                const fullPreviewUrl = `${backendUrl}${previewUrlPath}`;
                previewContent = `<iframe src="${fullPreviewUrl}" class="preview-iframe" title="ç¿»è¯‘ç»“æœPDFé¢„è§ˆ"></iframe>`;
            } else if (currentTranslationType === 'baidu-image') {
                // å¯¹äºå›¾ç‰‡ç¿»è¯‘ï¼Œæˆ‘ä»¬ä»ç„¶æ¨èä½¿ç”¨Base64ï¼Œä½†å¦‚æœåšæŒURLæ–¹å¼ï¼Œéœ€è¦åç«¯è¿”å›æ­£ç¡®çš„URL
                // è¿™é‡Œæš‚æ—¶ä¿æŒåŸæ ·ï¼Œå› ä¸ºå›¾ç‰‡é¢„è§ˆé—®é¢˜æ›´å¤æ‚
                 if (result.has_translated_image && result.download_url) {
                    const originalImageUrl = result.original_image_url ? `${backendUrl}${result.original_image_url}` : '';
                    const translatedImageUrl = result.download_url ? `${backendUrl}${result.download_url}` : '';
                    previewContent = `
                        <div class="preview-image-container horizontal">
                            <div class="preview-image-item"><h4>åŸå§‹å›¾ç‰‡</h4><img src="${originalImageUrl}" alt="åŸå§‹å›¾ç‰‡" class="preview-image"></div>
                            <div class="preview-image-item"><h4>ç¿»è¯‘åå›¾ç‰‡</h4><img src="${translatedImageUrl}" alt="ç¿»è¯‘åå›¾ç‰‡" class="preview-image"></div>
                        </div>`;
                }
            }
            
            detailsContent = generateDetailsContent(result);
            showDownloadButtons(result);
            
            // æ›´æ–°UI
            resultPreview.innerHTML = previewContent || '<div class="preview-placeholder"><h3>æ— å¯ç”¨é¢„è§ˆ</h3></div>';
            resultDetails.innerHTML = detailsContent;
            showStatusMessage('ç¿»è¯‘å®Œæˆï¼', 'success');

        } catch (error) {
            // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
            resultPreview.innerHTML = `<div class="preview-placeholder"><div class="placeholder-icon" style="color: #ef4444;">âŒ</div><div class="placeholder-text"><h3>å¤„ç†å¤±è´¥</h3><p>${error.message}</p></div></div>`;
            resultDetails.innerHTML = `<div class="details-placeholder"><p>è¯¦ç»†ä¿¡æ¯ä¸å¯ç”¨</p></div>`;
            showStatusMessage(`å¤„ç†å¤±è´¥: ${error.message}`, 'error');
            console.error("Display result error:", error);
        }
    }


        // æµ‹è¯•PDF URLçš„å¯è®¿é—®æ€§
        async function testPdfUrls(result) {
            try {
                let testUrl = '';
                
                if (currentTranslationType === 'poster' && result.pdf_download_url) {
                    const previewUrl = result.pdf_download_url.replace('/download/poster/', '/preview/poster/');
                    testUrl = `${backendUrl}${previewUrl}`;
                } else if (currentTranslationType.startsWith('webpage') && result.download_url) {
                    let previewUrl;
                    if (currentTranslationType === 'webpage-google') {
                        previewUrl = result.download_url.replace('/download/translated/', '/preview/translated/');
                    } else {
                        previewUrl = result.download_url.replace('/download/workflow/', '/preview/workflow/');
                    }
                    testUrl = `${backendUrl}${previewUrl}`;
                }
                
                if (testUrl) {
                    console.log('æµ‹è¯•PDF URL:', testUrl);
                    
                    const response = await fetch(testUrl, { method: 'HEAD' });
                    
                    if (response.ok) {
                        console.log('âœ… PDF URLæµ‹è¯•æˆåŠŸ:', response.status);
                        addLogEntry(`PDFé¢„è§ˆURLæµ‹è¯•æˆåŠŸ: ${response.status}`, 'success');
                    } else {
                        console.error('âŒ PDF URLæµ‹è¯•å¤±è´¥:', response.status, response.statusText);
                        addLogEntry(`PDFé¢„è§ˆURLæµ‹è¯•å¤±è´¥: ${response.status} ${response.statusText}`, 'error');
                    }
                }
            } catch (error) {
                console.error('PDF URLæµ‹è¯•å¼‚å¸¸:', error);
                addLogEntry(`PDFé¢„è§ˆURLæµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        function generatePreviewContent(result) {
            switch (currentTranslationType) {
                case 'poster':
                    // æµ·æŠ¥ç¿»è¯‘ - æ˜¾ç¤ºç¼–è¯‘åçš„PDFç»“æœ
                    if (result.pdf_generated && result.pdf_download_url) {
                        // å°†ä¸‹è½½URLè½¬æ¢ä¸ºé¢„è§ˆURL
                        const previewUrl = result.pdf_download_url.replace('/download/poster/', '/preview/poster/');
                        const fullPreviewUrl = `${backendUrl}${previewUrl}`;
                        
                        console.log('ğŸ” æµ·æŠ¥PDFé¢„è§ˆè°ƒè¯•ä¿¡æ¯:');
                        console.log('  - åŸå§‹ä¸‹è½½URL:', result.pdf_download_url);
                        console.log('  - è½¬æ¢åé¢„è§ˆURL:', previewUrl);
                        console.log('  - å®Œæ•´é¢„è§ˆURL:', fullPreviewUrl);
                        console.log('  - åç«¯URL:', backendUrl);
                        
                        // éªŒè¯URLæ ¼å¼
                        if (!fullPreviewUrl.startsWith('http')) {
                            console.error('âŒ é¢„è§ˆURLæ ¼å¼é”™è¯¯:', fullPreviewUrl);
                        }
                        
                        return `
                            <div class="preview-pdf-container" style="padding: 0; background: #ffffff; position: relative;">
                                <iframe src="${fullPreviewUrl}" 
                                        class="preview-iframe"
                                        title="æµ·æŠ¥ç¿»è¯‘PDFé¢„è§ˆ"
                                        onload="handlePdfIframeLoad(this)"
                                        onerror="handlePdfIframeError(this)"
                                        style="opacity: 0; transition: opacity 0.3s ease;">
                                </iframe>
                                <div class="pdf-fallback" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #64748b; z-index: 1;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“„</div>
                                    <h3>PDF é¢„è§ˆåŠ è½½ä¸­...</h3>
                                    <p>å¦‚æœæ— æ³•æ˜¾ç¤ºé¢„è§ˆï¼Œè¯·ç‚¹å‡»ä¸‹è½½æŒ‰é’®</p>
                                    <p style="font-size: 0.8em; color: #94a3b8; margin-top: 10px;">æ­£åœ¨åŠ è½½: ${previewUrl}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="preview-pdf-container">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 15px; color: #ef4444;">âŒ</div>
                                    <h3>PDF ç”Ÿæˆå¤±è´¥</h3>
                                    <p>LaTeX ä»£ç å·²ç”Ÿæˆï¼Œä½† PDF ç¼–è¯‘å¤±è´¥</p>
                                    ${result.pdf_message ? `<p style="margin-top: 10px; color: #ef4444; font-size: 0.9em;">${result.pdf_message}</p>` : ''}
                                </div>
                            </div>
                        `;
                    }

                case 'webpage-gpt':
                case 'webpage-google':
                    // ç½‘é¡µç¿»è¯‘ - æ˜¾ç¤ºç¿»è¯‘åçš„PDFå†…å®¹
                    if (result.download_url) {
                        // æ ¹æ®ç¿»è¯‘ç±»å‹ç¡®å®šé¢„è§ˆURL
                        let previewUrl;
                        if (currentTranslationType === 'webpage-google') {
                            previewUrl = result.download_url.replace('/download/translated/', '/preview/translated/');
                        } else {
                            previewUrl = result.download_url.replace('/download/workflow/', '/preview/workflow/');
                        }
                        
                        const fullPreviewUrl = `${backendUrl}${previewUrl}`;
                        
                        console.log('ğŸ” ç½‘é¡µPDFé¢„è§ˆè°ƒè¯•ä¿¡æ¯:');
                        console.log('  - åŸå§‹ä¸‹è½½URL:', result.download_url);
                        console.log('  - è½¬æ¢åé¢„è§ˆURL:', previewUrl);
                        console.log('  - å®Œæ•´é¢„è§ˆURL:', fullPreviewUrl);
                        console.log('  - åç«¯URL:', backendUrl);
                        console.log('  - å½“å‰ç¿»è¯‘ç±»å‹:', currentTranslationType);
                        
                        // éªŒè¯URLæ ¼å¼
                        if (!fullPreviewUrl.startsWith('http')) {
                            console.error('âŒ é¢„è§ˆURLæ ¼å¼é”™è¯¯:', fullPreviewUrl);
                        }
                        
                        return `
                            <div class="preview-pdf-container" style="padding: 0; background: #ffffff; position: relative;">
                                <iframe src="${fullPreviewUrl}" 
                                        class="preview-iframe"
                                        title="ç½‘é¡µç¿»è¯‘PDFé¢„è§ˆ"
                                        onload="handlePdfIframeLoad(this)"
                                        onerror="handlePdfIframeError(this)"
                                        style="opacity: 0; transition: opacity 0.3s ease;">
                                </iframe>
                                <div class="pdf-fallback" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #64748b; z-index: 1;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸŒ</div>
                                    <h3>PDF é¢„è§ˆåŠ è½½ä¸­...</h3>
                                    <p>æ–‡ä»¶å¤§å°: ${(result.file_size / 1024).toFixed(2)} KB</p>
                                    <p style="font-size: 0.8em; margin-top: 5px;">å¦‚æœæ— æ³•æ˜¾ç¤ºé¢„è§ˆï¼Œè¯·ç‚¹å‡»ä¸‹è½½æŒ‰é’®</p>
                                    <p style="font-size: 0.7em; color: #94a3b8; margin-top: 5px;">æ­£åœ¨åŠ è½½: ${previewUrl}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="preview-pdf-container">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 15px; color: #ef4444;">âŒ</div>
                                    <h3>PDF ç”Ÿæˆå¤±è´¥</h3>
                                    <p>ç½‘é¡µç¿»è¯‘è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜</p>
                                </div>
                            </div>
                        `;
                    }

                case 'baidu-image':
                    // å›¾ç‰‡ç¿»è¯‘ - æ˜¾ç¤ºåŸå›¾ä¸ç¿»è¯‘åå›¾ç‰‡çš„å¯¹æ¯”é¢„è§ˆ
                    if (result.has_translated_image && result.download_url) {
                        const containerId = `image-container-${Date.now()}`;
                        return `
                            <div id="${containerId}" class="preview-image-container horizontal">
                                <div class="preview-image-item">
                                    <h4>åŸå§‹å›¾ç‰‡</h4>
                                    <img id="${containerId}-original" 
                                         src="${result.original_image_url ? backendUrl + result.original_image_url : 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzlDQTNBRiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+5Y6f5aeL5Zu+54mH</dGV4dD4KPHN2Zz4K'}" 
                                         alt="åŸå§‹å›¾ç‰‡" class="preview-image" 
                                         onload="optimizeImageLayout('${containerId}')"
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzlDQTNBRiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+5Zu+54mH5LiN5Y+v55So</dGV4dD4KPHN2Zz4K'">
                                </div>
                                <div class="preview-image-item">
                                    <h4>ç¿»è¯‘åå›¾ç‰‡</h4>
                                    <img id="${containerId}-translated" 
                                         src="${backendUrl}${result.download_url}" 
                                         alt="ç¿»è¯‘åå›¾ç‰‡" class="preview-image"
                                         onload="optimizeImageLayout('${containerId}')"
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDIwMCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRUZGNkZGIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzEwQjk4MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSI+57+76K+R5ZCO5Zu+54mH</dGV4dD4KPHN2Zz4K'">
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="preview-pdf-container">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ–¼ï¸</div>
                                    <h3>å›¾ç‰‡ç¿»è¯‘å®Œæˆ</h3>
                                    <p>æ£€æµ‹åˆ°çš„æ–‡æœ¬å·²æˆåŠŸç¿»è¯‘</p>
                                    ${result.text_info && result.text_info.summary_dst ? 
                                        `<div style="margin-top: 15px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3b82f6;">
                                            <h4 style="color: #3b82f6; margin-bottom: 8px; font-size: 0.9em;">ç¿»è¯‘ç»“æœ:</h4>
                                            <p style="color: #f1f5f9; line-height: 1.5; margin: 0;">${result.text_info.summary_dst}</p>
                                        </div>` : ''}
                                </div>
                            </div>
                        `;
                    }

                default:
                    return `
                        <div class="preview-placeholder">
                            <div class="placeholder-icon">âœ…</div>
                            <div class="placeholder-text">
                                <h3>ç¿»è¯‘å®Œæˆ</h3>
                                <p>è¯·æŸ¥çœ‹ä¸‹æ–¹è¯¦æƒ…å¹¶ä¸‹è½½ç»“æœ</p>
                            </div>
                        </div>
                    `;
            }
        }

        function generateDetailsContent(result) {
            switch (currentTranslationType) {
                case 'poster':
                    return `
                        <div class="result-content">
                            <div class="result-item">
                                <h4>æµ·æŠ¥ç¿»è¯‘ç»“æœ</h4>
                                <p><strong>LaTeXç”Ÿæˆ:</strong> <span class="${result.latex_generated ? 'success' : 'error'}">${result.latex_generated ? 'æˆåŠŸ' : 'å¤±è´¥'}</span></p>
                                <p><strong>PDFç”Ÿæˆ:</strong> <span class="${result.pdf_generated ? 'success' : 'error'}">${result.pdf_generated ? 'æˆåŠŸ' : 'å¤±è´¥'}</span></p>
                                ${result.pdf_message ? `<p><strong>æ¶ˆæ¯:</strong> ${result.pdf_message}</p>` : ''}
                                <p><strong>LaTeXæ–‡ä»¶:</strong> ${result.tex_filename}</p>
                                ${result.pdf_filename ? `<p><strong>PDFæ–‡ä»¶:</strong> ${result.pdf_filename}</p>` : ''}
                                <p><strong>ä»£ç é•¿åº¦:</strong> ${result.latex_code_length} å­—ç¬¦</p>
                            </div>
                        </div>
                    `;

                case 'webpage-gpt':
                    return `
                        <div class="result-content">
                            <div class="result-item">
                                <h4>GPTç½‘é¡µç¿»è¯‘ç»“æœ</h4>
                                <p><strong>åŸå§‹é“¾æ¥:</strong> <a href="${result.original_url}" target="_blank" style="color: #3b82f6;">${result.original_url}</a></p>
                                <p><strong>çŠ¶æ€:</strong> <span class="success">ç¿»è¯‘æˆåŠŸ</span></p>
                                <p><strong>ç¿»è¯‘PDF:</strong> ${result.pdf_filename}</p>
                                <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(result.file_size / 1024).toFixed(2)} KB</p>
                                <p><strong>å¢å¼ºåŠŸèƒ½:</strong> 
                                    <span style="color: #10b981;">90% ç¼©æ”¾</span> | 
                                    <span style="color: #10b981;">è‡ªåŠ¨é‡è¯•</span> | 
                                    <span style="color: #10b981;">è¯¦ç»†æ—¥å¿—</span>
                                </p>
                            </div>
                        </div>
                    `;

                case 'webpage-google':
                    return `
                        <div class="result-content">
                            <div class="result-item">
                                <h4>ç¨³å®šç‰ˆç½‘é¡µç¿»è¯‘ç»“æœ</h4>
                                <p><strong>åŸå§‹é“¾æ¥:</strong> <a href="${result.original_url}" target="_blank" style="color: #3b82f6;">${result.original_url}</a></p>
                                <p><strong>çŠ¶æ€:</strong> <span class="success">ç¿»è¯‘æˆåŠŸ</span></p>
                                <p><strong>ç¿»è¯‘PDF:</strong> ${result.pdf_filename}</p>
                                <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(result.file_size / 1024).toFixed(2)} KB</p>
                            </div>
                        </div>
                    `;

                case 'baidu-image':
                    return `
                        <div class="result-content">
                            <div class="result-item">
                                <h4>å›¾ç‰‡ç¿»è¯‘ç»“æœ</h4>
                                <p><strong>ç¿»è¯‘æ–¹å‘:</strong> ${result.translation_direction}</p>
                                <p><strong>çŠ¶æ€:</strong> <span class="success">ç¿»è¯‘æˆåŠŸ</span></p>
                                ${result.has_translated_image ? `<p><strong>ç¿»è¯‘å›¾ç‰‡:</strong> ${result.translated_filename}</p>` : ''}
                                ${result.file_size ? `<p><strong>æ–‡ä»¶å¤§å°:</strong> ${(result.file_size / 1024).toFixed(2)} KB</p>` : ''}
                                ${result.text_info && result.text_info.summary_src ? `<p><strong>æ£€æµ‹åˆ°çš„æ–‡æœ¬:</strong> ${result.text_info.summary_src}</p>` : ''}
                                ${result.text_info && result.text_info.summary_dst ? `<p><strong>ç¿»è¯‘æ–‡æœ¬:</strong> ${result.text_info.summary_dst}</p>` : ''}
                                ${result.text_info && result.text_info.detected_texts && result.text_info.detected_texts.length > 0 ? 
                                    `<p><strong>æ–‡æœ¬å—æ•°é‡:</strong> ${result.text_info.detected_texts.length} ä¸ª</p>` : ''}
                            </div>
                        </div>
                    `;

                default:
                    return `
                        <div class="details-placeholder">
                            <p>å¤„ç†å®Œæˆï¼Œè¯¦ç»†ä¿¡æ¯ä¸å¯ç”¨</p>
                        </div>
                    `;
            }
        }

        function showDownloadButtons(result) {
            // éšè—æ‰€æœ‰ä¸‹è½½æŒ‰é’®
            document.querySelectorAll('.download-btn').forEach(btn => btn.style.display = 'none');



            switch (currentTranslationType) {
                case 'poster':
                    if (result.pdf_generated && result.pdf_download_url) {
                        document.getElementById('download-main-btn').textContent = 'ä¸‹è½½ç¿»è¯‘PDF';
                        document.getElementById('download-main-btn').style.display = 'block';
                    }
                    break;

                case 'webpage-gpt':
                case 'webpage-google':
                    if (result.download_url) {
                        document.getElementById('download-main-btn').textContent = 'ä¸‹è½½ç¿»è¯‘PDF';
                        document.getElementById('download-main-btn').style.display = 'block';
                    }
                    break;

                case 'baidu-image':
                    if (result.has_translated_image && result.download_url) {
                        document.getElementById('download-main-btn').textContent = 'ä¸‹è½½ç¿»è¯‘å›¾ç‰‡';
                        document.getElementById('download-main-btn').style.display = 'block';
                    }
                    break;
            }


        }

        function downloadMain() {
            if (!translationResult) return;
            
            let downloadUrl = '';
            let filename = '';
            let fileType = '';
            
            switch (currentTranslationType) {
                case 'poster':
                    downloadUrl = translationResult.pdf_download_url;
                    filename = translationResult.pdf_filename;
                    fileType = 'PDFæ–‡ä»¶';
                    break;
                case 'webpage-gpt':
                case 'webpage-google':
                    downloadUrl = translationResult.download_url;
                    filename = translationResult.pdf_filename;
                    fileType = 'PDFæ–‡ä»¶';
                    break;
                case 'baidu-image':
                    downloadUrl = translationResult.download_url;
                    filename = translationResult.translated_filename;
                    fileType = 'ç¿»è¯‘å›¾ç‰‡';
                    break;
            }
            
            if (downloadUrl) {
                addLogEntry(`å¼€å§‹ä¸‹è½½${fileType}: ${filename}`, 'info');
                window.open(`${backendUrl}${downloadUrl}`, '_blank');
                showStatusMessage('æ–‡ä»¶ä¸‹è½½å·²å¼€å§‹', 'success');
            }
        }

        // PDF iframeå¤„ç†å‡½æ•°
        function handlePdfIframeLoad(iframe) {
            console.log('ğŸ”„ PDF iframe åŠ è½½äº‹ä»¶è§¦å‘');
            console.log('  - å½“å‰src:', iframe.src);
            console.log('  - iframeçŠ¶æ€:', iframe.readyState);
            
            // æ£€æŸ¥iframeæ˜¯å¦æŒ‡å‘äº†é”™è¯¯çš„URL
            if (iframe.src === `${backendUrl}/` || iframe.src === backendUrl || iframe.src === 'about:blank') {
                console.error('âŒ iframeè¢«é‡å®šå‘åˆ°é”™è¯¯çš„URL:', iframe.src);
                handlePdfIframeError(iframe);
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯PDFé¢„è§ˆURL
            if (!iframe.src.includes('/preview/')) {
                console.error('âŒ iframe URLä¸æ˜¯é¢„è§ˆURL:', iframe.src);
                handlePdfIframeError(iframe);
                return;
            }
            
            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´å†æ˜¾ç¤ºï¼Œç¡®ä¿PDFçœŸæ­£åŠ è½½å®Œæˆ
            setTimeout(() => {
                iframe.style.opacity = '1';
                
                // éšè—åŠ è½½æç¤º
                const fallback = iframe.parentElement.querySelector('.pdf-fallback');
                if (fallback) {
                    fallback.style.display = 'none';
                }
                
                console.log('âœ… PDFé¢„è§ˆæ˜¾ç¤ºæˆåŠŸ');
            }, 500);
        }

        function handlePdfIframeError(iframe) {
            console.error('PDF iframe åŠ è½½å¤±è´¥, src:', iframe.src);
            iframe.style.opacity = '0';
            
            // å°è¯•å¤‡ç”¨é¢„è§ˆæ–¹æ¡ˆ
            if (tryAlternativePdfPreview(iframe)) {
                console.log('å°è¯•ä½¿ç”¨å¤‡ç”¨PDFé¢„è§ˆæ–¹æ¡ˆ');
                return;
            }
            
            // æ˜¾ç¤ºé”™è¯¯æç¤º
            const fallback = iframe.parentElement.querySelector('.pdf-fallback');
            if (fallback) {
                fallback.style.display = 'block';
                fallback.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 15px; color: #ef4444;">âš ï¸</div>
                    <h3>PDF é¢„è§ˆä¸å¯ç”¨</h3>
                    <p>å¯èƒ½çš„åŸå› ï¼š</p>
                    <ul style="text-align: left; font-size: 0.9em; margin: 10px 0;">
                        <li>æµè§ˆå™¨ä¸æ”¯æŒPDFé¢„è§ˆ</li>
                        <li>PDFæ–‡ä»¶æŸåæˆ–ä¸å­˜åœ¨</li>
                        <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                    </ul>
                    <p style="font-size: 0.9em; margin-top: 15px; color: #3b82f6;">ğŸ’¡ å»ºè®®ç‚¹å‡»ä¸‹æ–¹ä¸‹è½½æŒ‰é’®è·å–PDFæ–‡ä»¶</p>
                    <button onclick="window.open('${iframe.src}', '_blank')" style="margin-top: 10px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€PDF
                    </button>
                    <button onclick="tryReloadPdfIframe('${iframe.src}')" style="margin-left: 10px; margin-top: 10px; padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        é‡æ–°åŠ è½½é¢„è§ˆ
                    </button>
                    <button onclick="testPdfInfrastructure()" style="margin-left: 10px; margin-top: 10px; padding: 8px 16px; background: #8b5cf6; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        æµ‹è¯•é¢„è§ˆåŠŸèƒ½
                    </button>
                `;
            }
        }

        // å°è¯•å¤‡ç”¨PDFé¢„è§ˆæ–¹æ¡ˆ
        function tryAlternativePdfPreview(iframe) {
            try {
                const container = iframe.parentElement;
                const pdfUrl = iframe.src;
                
                // åˆ›å»ºobjectå…ƒç´ ä½œä¸ºå¤‡ç”¨
                const objectElement = document.createElement('object');
                objectElement.data = pdfUrl;
                objectElement.type = 'application/pdf';
                objectElement.style.width = '100%';
                objectElement.style.height = '100%';
                objectElement.style.border = 'none';
                
                // æ·»åŠ å¤±è´¥å›è°ƒ
                objectElement.onerror = function() {
                    console.error('å¤‡ç”¨PDFé¢„è§ˆæ–¹æ¡ˆä¹Ÿå¤±è´¥äº†');
                    return false;
                };
                
                // æ›¿æ¢iframe
                container.removeChild(iframe);
                container.appendChild(objectElement);
                
                console.log('å·²åˆ‡æ¢åˆ°objectå…ƒç´ é¢„è§ˆPDF');
                return true;
                
            } catch (error) {
                console.error('å¤‡ç”¨PDFé¢„è§ˆæ–¹æ¡ˆå¤±è´¥:', error);
                return false;
            }
        }

        // æ£€æµ‹iframeæ˜¯å¦çœŸæ­£åŠ è½½äº†PDFå†…å®¹
        function checkIframeContent(iframe) {
            try {
                // æ£€æŸ¥iframeæ˜¯å¦æˆåŠŸåŠ è½½
                if (iframe.contentWindow && iframe.contentWindow.location.href === 'about:blank') {
                    console.warn('iframeå†…å®¹ä¸ºç©ºç™½é¡µé¢');
                    handlePdfIframeError(iframe);
                    return false;
                }
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                fetch(iframe.src)
                    .then(response => {
                        if (!response.ok) {
                            console.error('PDFæ–‡ä»¶è¯·æ±‚å¤±è´¥:', response.status, response.statusText);
                            handlePdfIframeError(iframe);
                        } else {
                            console.log('PDFæ–‡ä»¶è¯·æ±‚æˆåŠŸ:', response.status);
                        }
                    })
                    .catch(error => {
                        console.error('PDFæ–‡ä»¶æ£€æŸ¥å¤±è´¥:', error);
                        handlePdfIframeError(iframe);
                    });
                
                return true;
            } catch (e) {
                console.error('æ£€æŸ¥iframeå†…å®¹æ—¶å‡ºé”™:', e);
                return false;
            }
        }

        // æ£€æŸ¥æµè§ˆå™¨PDFæ”¯æŒ
        function checkPdfSupport() {
            // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒPDFåµŒå…¥
            const pdfPluginSupported = navigator.mimeTypes && navigator.mimeTypes['application/pdf'];
            const chromeWithPdfViewer = navigator.userAgent.indexOf('Chrome') > -1;
            const firefoxWithPdfViewer = navigator.userAgent.indexOf('Firefox') > -1;
            
            return pdfPluginSupported || chromeWithPdfViewer || firefoxWithPdfViewer;
        }

        // è°ƒè¯•åŠŸèƒ½ï¼šè·å–å¯ç”¨PDFæ–‡ä»¶åˆ—è¡¨
        async function debugPdfFiles() {
            try {
                const response = await fetch(`${backendUrl}/api/debug/pdf-files`);
                const result = await response.json();
                
                console.log('ğŸ“ å¯ç”¨PDFæ–‡ä»¶:', result);
                
                if (result.success) {
                    let debugInfo = 'ğŸ“ å¯ç”¨PDFæ–‡ä»¶åˆ—è¡¨:\n';
                    
                    if (result.files.poster && result.files.poster.length > 0) {
                        debugInfo += `\nğŸ¨ æµ·æŠ¥æ–‡ä»¶ (${result.files.poster.length}ä¸ª):\n`;
                        result.files.poster.forEach(file => {
                            debugInfo += `  - ${file}\n`;
                            debugInfo += `    é¢„è§ˆ: ${backendUrl}/preview/poster/${file}\n`;
                        });
                    }
                    
                    if (result.files.translated && result.files.translated.length > 0) {
                        debugInfo += `\nğŸŒ Googleç¿»è¯‘æ–‡ä»¶ (${result.files.translated.length}ä¸ª):\n`;
                        result.files.translated.forEach(file => {
                            debugInfo += `  - ${file}\n`;
                            debugInfo += `    é¢„è§ˆ: ${backendUrl}/preview/translated/${file}\n`;
                        });
                    }
                    
                    if (result.files.workflow && Object.keys(result.files.workflow).length > 0) {
                        debugInfo += `\nğŸ”„ å·¥ä½œæµç¨‹æ–‡ä»¶:\n`;
                        Object.keys(result.files.workflow).forEach(folder => {
                            debugInfo += `  ğŸ“‚ ${folder}:\n`;
                            result.files.workflow[folder].forEach(file => {
                                debugInfo += `    - ${file}\n`;
                                debugInfo += `      é¢„è§ˆ: ${backendUrl}/preview/workflow/${folder}/${file}\n`;
                            });
                        });
                    }
                    
                    console.log(debugInfo);
                    addLogEntry('PDFæ–‡ä»¶åˆ—è¡¨å·²åœ¨æ§åˆ¶å°æ˜¾ç¤º', 'info');
                } else {
                    console.error('è·å–PDFæ–‡ä»¶åˆ—è¡¨å¤±è´¥:', result.error);
                    addLogEntry(`è·å–PDFæ–‡ä»¶åˆ—è¡¨å¤±è´¥: ${result.error}`, 'error');
                }
                
            } catch (error) {
                console.error('è°ƒè¯•åŠŸèƒ½å¼‚å¸¸:', error);
                addLogEntry(`è°ƒè¯•åŠŸèƒ½å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // å…¨å±€æš´éœ²è°ƒè¯•å‡½æ•°ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
        window.debugPdfFiles = debugPdfFiles;
        window.testPdfPreview = function(url) {
            window.open(url, '_blank');
        };
        window.detectScreenSize = detectScreenSize;
        window.applyAdaptiveLayout = applyAdaptiveLayout;
        window.testCurrentPdf = function() {
            if (!translationResult) {
                console.log('âŒ å½“å‰æ²¡æœ‰ç¿»è¯‘ç»“æœ');
                return;
            }
            
            let previewUrl = '';
            
            if (currentTranslationType === 'poster' && translationResult.pdf_download_url) {
                previewUrl = translationResult.pdf_download_url.replace('/download/poster/', '/preview/poster/');
            } else if (currentTranslationType.startsWith('webpage') && translationResult.download_url) {
                if (currentTranslationType === 'webpage-google') {
                    previewUrl = translationResult.download_url.replace('/download/translated/', '/preview/translated/');
                } else {
                    previewUrl = translationResult.download_url.replace('/download/workflow/', '/preview/workflow/');
                }
            }
            
            if (previewUrl) {
                const fullUrl = `${backendUrl}${previewUrl}`;
                console.log('ğŸ” æµ‹è¯•å½“å‰PDFé¢„è§ˆURL:', fullUrl);
                window.open(fullUrl, '_blank');
            } else {
                console.log('âŒ å½“å‰ç¿»è¯‘ç»“æœæ²¡æœ‰PDFæ–‡ä»¶');
            }
        };
        
        // é‡æ–°åŠ è½½PDF iframe
        window.tryReloadPdfIframe = function(pdfUrl) {
            console.log('ğŸ”„ å°è¯•é‡æ–°åŠ è½½PDFé¢„è§ˆ:', pdfUrl);
            
            // æŸ¥æ‰¾å½“å‰çš„PDFå®¹å™¨
            const pdfContainers = document.querySelectorAll('.preview-pdf-container');
            
            pdfContainers.forEach(container => {
                const iframe = container.querySelector('iframe');
                if (iframe && (iframe.src === pdfUrl || iframe.src.includes('/preview/'))) {
                    console.log('æ‰¾åˆ°åŒ¹é…çš„iframeï¼Œé‡æ–°åŠ è½½...');
                    
                    // é‡ç½®iframe
                    iframe.style.opacity = '0';
                    
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    const fallback = container.querySelector('.pdf-fallback');
                    if (fallback) {
                        fallback.style.display = 'block';
                        fallback.innerHTML = `
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ”„</div>
                            <h3>é‡æ–°åŠ è½½PDFé¢„è§ˆ...</h3>
                            <p>æ­£åœ¨å°è¯•é‡æ–°åŠ è½½é¢„è§ˆå†…å®¹</p>
                        `;
                    }
                    
                    // å»¶è¿Ÿé‡æ–°è®¾ç½®src
                    setTimeout(() => {
                        iframe.src = pdfUrl;
                        console.log('iframe srcå·²é‡æ–°è®¾ç½®ä¸º:', pdfUrl);
                    }, 1000);
                }
            });
        };

        // æµ‹è¯•PDFé¢„è§ˆåŠŸèƒ½åŸºç¡€è®¾æ–½
        window.testPdfInfrastructure = function() {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•PDFé¢„è§ˆåŸºç¡€è®¾æ–½...');
            
            // æµ‹è¯•åŸºæœ¬çš„iframeåŠŸèƒ½
            const testUrl = `${backendUrl}/api/test/pdf-preview`;
            console.log('æµ‹è¯•URL:', testUrl);
            
            // åˆ›å»ºæµ‹è¯•iframe
            const testContainer = document.createElement('div');
            testContainer.style.cssText = `
                position: fixed; top: 50px; right: 50px; width: 400px; height: 300px;
                background: white; border: 2px solid #3b82f6; border-radius: 8px;
                z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            
            testContainer.innerHTML = `
                <div style="padding: 10px; background: #3b82f6; color: white; font-weight: bold;">
                    PDFé¢„è§ˆåŠŸèƒ½æµ‹è¯•
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="float: right; background: none; border: none; color: white; cursor: pointer;">âœ•</button>
                </div>
                <iframe src="${testUrl}" style="width: 100%; height: calc(100% - 40px); border: none;"></iframe>
            `;
            
            document.body.appendChild(testContainer);
            
            // 5ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                if (testContainer.parentElement) {
                    testContainer.remove();
                    console.log('âœ… PDFé¢„è§ˆåŠŸèƒ½æµ‹è¯•å®Œæˆ');
                }
            }, 5000);
        };

        // å›¾ç‰‡å¸ƒå±€ä¼˜åŒ–å‡½æ•°
        function optimizeImageLayout(containerId) {
            try {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const originalImg = document.getElementById(`${containerId}-original`);
                const translatedImg = document.getElementById(`${containerId}-translated`);
                
                // ç­‰å¾…ä¸¤å¼ å›¾ç‰‡éƒ½åŠ è½½å®Œæˆ
                if (!originalImg || !translatedImg || !originalImg.complete || !translatedImg.complete) {
                    // å¦‚æœæœ‰å›¾ç‰‡è¿˜æ²¡åŠ è½½å®Œï¼Œç¨åå†è¯•
                    setTimeout(() => optimizeImageLayout(containerId), 100);
                    return;
                }
                
                // è·å–å®¹å™¨å°ºå¯¸
                const containerRect = container.getBoundingClientRect();
                const containerWidth = containerRect.width - 30; // å‡å»padding
                const containerHeight = containerRect.height - 30;
                
                // è·å–å›¾ç‰‡åŸå§‹å°ºå¯¸
                const img1Width = originalImg.naturalWidth || originalImg.width;
                const img1Height = originalImg.naturalHeight || originalImg.height;
                const img2Width = translatedImg.naturalWidth || translatedImg.width;
                const img2Height = translatedImg.naturalHeight || translatedImg.height;
                
                console.log(`å®¹å™¨å°ºå¯¸: ${containerWidth} x ${containerHeight}`);
                console.log(`åŸå›¾å°ºå¯¸: ${img1Width} x ${img1Height}`);
                console.log(`ç¿»è¯‘å›¾å°ºå¯¸: ${img2Width} x ${img2Height}`);
                
                if (img1Width === 0 || img1Height === 0 || img2Width === 0 || img2Height === 0) {
                    console.log('å›¾ç‰‡å°ºå¯¸æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å¸ƒå±€');
                    return;
                }
                
                // è®¡ç®—å›¾ç‰‡çš„é•¿å®½æ¯”
                const img1Ratio = img1Width / img1Height;
                const img2Ratio = img2Width / img2Height;
                const containerRatio = containerWidth / containerHeight;
                
                // è®¡ç®—ä¸¤ç§å¸ƒå±€æ–¹æ¡ˆçš„ç©ºé—´åˆ©ç”¨ç‡
                let horizontalUtilization = 0;
                let verticalUtilization = 0;
                
                // æ°´å¹³æ’åˆ—æ—¶çš„è®¡ç®—
                const horizontalAvailableWidth = containerWidth / 2 - 7.5; // å‡å»gapçš„ä¸€åŠ
                const horizontalImg1Scale = Math.min(
                    horizontalAvailableWidth / img1Width,
                    containerHeight / img1Height
                );
                const horizontalImg2Scale = Math.min(
                    horizontalAvailableWidth / img2Width,
                    containerHeight / img2Height
                );
                horizontalUtilization = (
                    (img1Width * horizontalImg1Scale) + (img2Width * horizontalImg2Scale) + 15
                ) / containerWidth;
                
                // å‚ç›´æ’åˆ—æ—¶çš„è®¡ç®—
                const verticalAvailableHeight = containerHeight / 2 - 30; // å‡å»æ ‡é¢˜å’Œgap
                const verticalImg1Scale = Math.min(
                    containerWidth / img1Width,
                    verticalAvailableHeight / img1Height
                );
                const verticalImg2Scale = Math.min(
                    containerWidth / img2Width,
                    verticalAvailableHeight / img2Height
                );
                verticalUtilization = Math.max(
                    (img1Height * verticalImg1Scale + 30) / containerHeight,
                    (img2Height * verticalImg2Scale + 30) / containerHeight
                );
                
                console.log(`æ°´å¹³å¸ƒå±€åˆ©ç”¨ç‡: ${horizontalUtilization.toFixed(3)}`);
                console.log(`å‚ç›´å¸ƒå±€åˆ©ç”¨ç‡: ${verticalUtilization.toFixed(3)}`);
                
                // é€‰æ‹©ç©ºé—´åˆ©ç”¨ç‡æ›´é«˜çš„å¸ƒå±€
                const useHorizontal = horizontalUtilization >= verticalUtilization;
                
                // åº”ç”¨å¸ƒå±€
                container.className = `preview-image-container ${useHorizontal ? 'horizontal' : 'vertical'}`;
                
                console.log(`é€‰æ‹©${useHorizontal ? 'æ°´å¹³' : 'å‚ç›´'}å¸ƒå±€`);
                
                // å¼ºåˆ¶é‡æ–°å¸ƒå±€
                setTimeout(() => {
                    container.style.display = 'none';
                    container.offsetHeight; // è§¦å‘é‡æ’
                    container.style.display = 'flex';
                }, 10);
                
            } catch (error) {
                console.error('å¸ƒå±€ä¼˜åŒ–å¤±è´¥:', error);
            }
        }

        // æ·»åŠ é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
            hideLoading();
            addLogEntry(`åº”ç”¨ç¨‹åºé”™è¯¯: ${e.error?.message || e.message}`, 'error');
            showStatusMessage('å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°', 'error');
            console.error('Application error:', e.error);
        });
    </script>
</body>
</html>